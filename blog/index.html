<!DOCTYPE html>
<html lang="vi">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P3RFV6Q9QV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-P3RFV6Q9QV');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anaro Coffee Collection Blog</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f1eb 0%, #ede7df 100%);
            color: #4a3c2a;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Mobile Search Header */
        .mobile-header {
            display: none;
            position: sticky;
            top: 0;
            z-index: 200;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e0d0c0;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .mobile-header-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mobile-logo {
            color: #7a5c3f;
            font-size: 1.2em;
            font-weight: 600;
            white-space: nowrap;
        }

        .mobile-search-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0d0c0;
            border-radius: 20px;
            background: #faf8f5;
            color: #4a3c2a;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .mobile-search-input:focus {
            outline: none;
            border-color: #7a5c3f;
            background: white;
            box-shadow: 0 0 0 3px rgba(122, 92, 63, 0.1);
        }

        .mobile-refresh-btn {
            background: linear-gradient(135deg, #8b6b47 0%, #7a5c3f 100%);
            color: white;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 40px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e0d0c0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: #7a5c3f;
            font-size: 1.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-container {
            position: relative;
            max-width: 400px;
            flex: 1;
            margin: 0 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0d0c0;
            border-radius: 25px;
            background: #faf8f5;
            color: #4a3c2a;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #7a5c3f;
            background: white;
            box-shadow: 0 0 0 3px rgba(122, 92, 63, 0.1);
        }

        .search-input::placeholder {
            color: #8b6b47;
        }

        .refresh-btn, .shopee-refresh-btn {
            background: linear-gradient(135deg, #8b6b47 0%, #7a5c3f 100%);
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2em;
        }

        .refresh-btn:hover, .shopee-refresh-btn:hover {
            background: linear-gradient(135deg, #7a5c3f 0%, #6b4d35 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(122, 92, 63, 0.3);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .main-content {
            min-width: 0;
        }

        .page-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title h1 {
            color: #7a5c3f;
            font-size: 2.5em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .page-title p {
            color: #6b5b4d;
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Featured Post Spotlight */
        .featured-section {
            margin-bottom: 40px;
        }

        .featured-label {
            background: linear-gradient(135deg, #7a5c3f 0%, #8b6b47 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(122, 92, 63, 0.3);
        }

        .featured-post {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid #f0ece6;
            transition: all 0.3s ease;
            position: relative;
        }

        .featured-post:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .featured-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: #7a5c3f;
            position: relative;
            overflow: hidden;
        }

        .featured-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .featured-content {
            padding: 30px;
        }

        .featured-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .featured-date {
            color: #8b6b47;
            font-weight: 500;
        }

        .featured-reading-time {
            color: #8b6b47;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .featured-title {
            color: #4a3c2a;
            font-weight: 700;
            font-size: 1.8em;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .featured-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .featured-title a:hover {
            color: #7a5c3f;
        }

        .featured-excerpt {
            color: #6b5b4d;
            font-size: 1.1em;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .featured-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .featured-tag {
            background: linear-gradient(135deg, #7a5c3f 0%, #8b6b47 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 500;
            text-transform: capitalize;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .featured-tag:hover {
            background: linear-gradient(135deg, #6b4d35 0%, #7a5c3f 100%);
            transform: translateY(-2px);
        }

        /* Filter Navigation with Dropdown */
        .filter-nav {
            margin-bottom: 40px;
            text-align: center;
        }

        .filter-nav h3 {
            color: #7a5c3f;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-container {
            position: relative;
            display: inline-block;
            min-width: 300px;
        }

        .filter-dropdown {
            background: white;
            border: 2px solid #e0d0c0;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            color: #4a3c2a;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .filter-dropdown:hover {
            border-color: #7a5c3f;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(122, 92, 63, 0.2);
        }

        .filter-dropdown.active {
            border-color: #7a5c3f;
            background: #f8f5f0;
        }

        .dropdown-arrow {
            color: #7a5c3f;
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .filter-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .filter-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #7a5c3f;
            border-top: none;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .filter-options.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filter-option {
            padding: 12px 20px;
            cursor: pointer;
            color: #4a3c2a;
            font-weight: 500;
            text-transform: capitalize;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .filter-option:last-child {
            border-bottom: none;
        }

        .filter-option:hover {
            background: #f8f5f0;
            color: #7a5c3f;
            transform: translateX(5px);
        }

        .filter-option.selected {
            background: #7a5c3f;
            color: white;
        }

        .filter-option.selected:hover {
            background: #6b4d35;
        }

        /* Shopee Products Widget - Enhanced with Mobile Carousel */
        .shopee-widget {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid #e0d0c0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .shopee-widget h3 {
            color: #7a5c3f;
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .shopee-products {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        /* Mobile Carousel Styles */
        .shopee-products.mobile-carousel {
            display: block;
            position: relative;
        }

        .mobile-carousel-container {
            display: flex;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .mobile-carousel-container .shopee-product {
            min-width: 100%;
            flex-shrink: 0;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .carousel-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e0d0c0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .carousel-dot.active {
            background: #7a5c3f;
            transform: scale(1.2);
        }

        .carousel-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .carousel-nav-btn {
            background: linear-gradient(135deg, #8b6b47 0%, #7a5c3f 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .carousel-nav-btn:hover {
            background: linear-gradient(135deg, #7a5c3f 0%, #6b4d35 100%);
            transform: translateY(-2px);
        }

        .shopee-refresh-btn {
            margin-bottom: 20px;
            font-size: 1em;
            padding: 10px 20px;
        }

        .shopee-product {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #f0ece6;
            transition: all 0.3s ease;
            position: relative;
            text-decoration: none;
            color: inherit;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .shopee-product:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-color: #ff6b35;
        }

        .shopee-product-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: #7a5c3f;
            overflow: hidden;
            position: relative;
        }

        .shopee-product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .shopee-product:hover .shopee-product-image img {
            transform: scale(1.15);
        }

        .shopee-product-info {
            padding: 20px;
        }

        .shopee-product-name {
            font-size: 1em;
            font-weight: 600;
            color: #4a3c2a;
            margin-bottom: 10px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.6em;
        }

        .shopee-product-price {
            color: #e74c3c;
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .shopee-product-old-price {
            color: #999;
            font-size: 0.9em;
            text-decoration: line-through;
            margin-left: 8px;
        }

        .shopee-cta-button {
            background: linear-gradient(135deg, #ff6b35 0%, #e74c3c 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .shopee-cta-button:hover {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .shopee-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff6b35, #f39c12);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .shopee-discount {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 700;
        }

        /* Posts Grid */
        .posts-section h2 {
            color: #7a5c3f;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .post-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0ece6;
            transition: all 0.3s ease;
            position: relative;
        }

        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }

        .post-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: #7a5c3f;
            position: relative;
            overflow: hidden;
        }

        .post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-image.emoji {
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
        }

        .post-content {
            padding: 20px;
        }

        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .post-date {
            color: #8b6b47;
            font-size: 0.9em;
            font-weight: 500;
        }

        .post-reading-time {
            color: #8b6b47;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-title {
            color: #4a3c2a;
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .post-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .post-title a:hover {
            color: #7a5c3f;
        }

        .post-excerpt {
            color: #6b5b4d;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .post-tag {
            background: linear-gradient(135deg, #7a5c3f 0%, #8b6b47 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 500;
            text-transform: capitalize;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .post-tag:hover {
            background: linear-gradient(135deg, #6b4d35 0%, #7a5c3f 100%);
            transform: translateY(-1px);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 40px 0;
        }

        .pagination-btn {
            background: white;
            color: #7a5c3f;
            border: 2px solid #e0d0c0;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 45px;
            text-align: center;
            user-select: none;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #7a5c3f;
            color: white;
            border-color: #7a5c3f;
            transform: translateY(-1px);
        }

        .pagination-btn.active {
            background: #7a5c3f;
            color: white;
            border-color: #7a5c3f;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .pagination-info {
            color: #8b6b47;
            font-weight: 500;
            margin: 0 10px;
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #8b6b47;
        }

        .no-results-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .no-results h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #7a5c3f;
        }

        .no-results p {
            font-size: 1.1em;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Stats */
        .stats {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #e0d0c0;
        }

        .stats-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #7a5c3f;
            font-weight: 600;
        }

        .stat-number {
            font-size: 1.2em;
            color: #4a3c2a;
        }

        /* Footer */
        .footer {
            background: rgba(255, 255, 255, 0.9);
            border-top: 1px solid #e0d0c0;
            padding: 40px 20px;
            text-align: center;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            color: #8b6b47;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #7a5c3f;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: #4a3c2a;
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e0d0c0;
            border-top: 4px solid #7a5c3f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                display: none;
            }

            .mobile-header {
                display: block;
            }

            .container {
                padding: 20px 15px;
            }

            .filter-container {
                min-width: 250px;
                width: 100%;
                max-width: 400px;
            }
            
            .filter-options {
                max-height: 200px;
            }

            .posts-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .shopee-products {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .shopee-product-image {
                height: 200px;
                font-size: 4em;
            }

            .shopee-widget {
                padding: 20px;
                margin-bottom: 30px;
            }

            .shopee-widget h3 {
                font-size: 1.2em;
                margin-bottom: 20px;
            }

            .shopee-product-info {
                padding: 15px;
            }

            .shopee-product-name {
                font-size: 1.1em;
            }

            .shopee-product-price {
                font-size: 1.3em;
            }

            .shopee-cta-button {
                padding: 15px 20px;
                font-size: 1em;
            }

            .featured-image {
                height: 220px;
                font-size: 3em;
            }

            .featured-content {
                padding: 20px;
            }

            .featured-title {
                font-size: 1.5em;
            }

            .page-title h1 {
                font-size: 2em;
            }

            .stats-content {
                gap: 15px;
            }

            .footer-links {
                flex-direction: column;
                gap: 15px;
            }

            .pagination {
                gap: 10px;
            }

            .pagination-btn {
                padding: 8px 12px;
                min-width: 40px;
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px 10px;
            }

            .featured-content {
                padding: 15px;
            }

            .post-content {
                padding: 15px;
            }

            .mobile-header-content {
                gap: 10px;
            }

            .mobile-logo {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">‚òï Anaro</div>
            <input type="text" class="mobile-search-input" id="mobileSearchInput" placeholder="T√¨m ki·∫øm...">
            <button class="mobile-refresh-btn" id="mobileRefreshBtn" title="T·∫£i l·∫°i">üîÑ</button>
        </div>
    </div>

    <!-- Desktop Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                ‚òï Anaro Coffee Blog
            </div>
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="T√¨m ki·∫øm b√†i vi·∫øt...">
            </div>
            <button class="refresh-btn" id="refreshBtn" title="T·∫£i l·∫°i posts">üîÑ</button>
        </div>
    </header>

    <div class="container">
        <div class="page-title">
            <h1>‚òï Coffee Blog</h1>
            <p>Kh√°m ph√° th·∫ø gi·ªõi c√† ph√™ qua nh·ªØng c√¢u chuy·ªán, ki·∫øn th·ª©c v√† tr·∫£i nghi·ªám th√∫ v·ªã</p>
        </div>

        <div class="stats">
            <div class="stats-content">
                <div class="stat-item">
                    üìù <span class="stat-number" id="totalPosts">0</span> B√†i vi·∫øt
                </div>
                <div class="stat-item">
                    üè∑Ô∏è <span class="stat-number" id="totalTags">0</span> Ch·ªß ƒë·ªÅ
                </div>
                <div class="stat-item">
                    üìÖ C·∫≠p nh·∫≠t <span class="stat-number">H√¥m nay</span>
                </div>
            </div>
        </div>

        <!-- Featured Post Section -->
        <div class="featured-section">
            <div class="featured-label">üåü B√†i Vi·∫øt N·ªïi B·∫≠t</div>
            <div class="featured-post" id="featuredPost">
                <!-- Featured post will be inserted here -->
            </div>
        </div>

        <!-- Shopee Products Widget -->
        <div class="shopee-widget" id="shopeeWidget" style="display: none;">
            <h3>üõí S·∫£n Ph·∫©m T·ª´ B√†i Vi·∫øt</h3>
            <div class="shopee-products" id="shopeeProducts">
                <!-- Products will be inserted here -->
            </div>
        </div>

        <!-- Filter Navigation with Dropdown -->
        <div class="filter-nav">
            <h3>üéØ L·ªçc theo ch·ªß ƒë·ªÅ</h3>
            <div class="filter-container">
                <div class="filter-dropdown" id="filterDropdown">
                    <span id="selectedFilter">T·∫•t c·∫£</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </div>
                <div class="filter-options" id="filterOptions">
                    <div class="filter-option selected" data-tag="all">T·∫•t c·∫£</div>
                    <!-- Dynamic options will be added here -->
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Other Posts Section -->
            <div class="posts-section">
                <h2>üìö C√°c B√†i Vi·∫øt Kh√°c</h2>
                
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px; color: #8b6b47;">ƒêang t·∫£i b√†i vi·∫øt...</p>
                </div>

                <div class="posts-grid" id="postsGrid">
                    <!-- Posts will be inserted here -->
                </div>

                <div class="no-results" id="noResults" style="display: none;">
                    <div class="no-results-icon">üîç</div>
                    <h3>Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt</h3>
                    <p>Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c ho·∫∑c ch·ªçn ch·ªß ƒë·ªÅ kh√°c</p>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination" style="display: none;">
                    <button class="pagination-btn" id="prevBtn" disabled>‚Äπ Tr∆∞·ªõc</button>
                    <div class="pagination-info" id="paginationInfo"></div>
                    <button class="pagination-btn" id="nextBtn">Sau ‚Ä∫</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#about">V·ªÅ ch√∫ng t√¥i</a>
                <a href="#contact">Li√™n h·ªá</a>
                <a href="#rss">RSS</a>
                <a href="#github">GitHub</a>
            </div>
            <p>¬© 2024 Anaro Coffee Collection. Made with ‚òï and ‚ù§Ô∏è</p>
        </div>
    </footer>

    <script>
        // ====================================================================
        // üõí SHOPEE WIDGET - COMPLETE MODULE (From Document 1)
        // ====================================================================

        // Configuration
        const SHOPEE_CONFIG = {
            maxProductsPerPost: 6,
            desktopProductsCount: 3,
            mobileProductsCount: 1
        };

        // Global variables for Shopee
        let currentProductIndex = 0;
        let isMobile = false;
        let extractedShopeeProducts = [];

        // Demo Shopee products data with your links
        const demoShopeeProducts = [
            {
                name: "B·ªô T√°ch Cafe G·ªëm S·ª© Cao C·∫•p K√®m ƒêƒ©a",
                price: "90.000ƒë",
                image: "https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=300&h=200&fit=crop",
                url: "https://s.shopee.vn/1LWRLK1RkU",
                badge: "Cao c·∫•p"
            },
            {
                name: "·∫§m R√≥t N∆∞·ªõc C·ªï Ng·ªóng Chuy√™n Nghi·ªáp",
                price: "189.000ƒë",
                image: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=300&h=200&fit=crop",
                url: "https://s.shopee.vn/1VprXd0oPX",
                badge: "Best seller"
            },
            {
                name: "B√¨nh Pha C√† Ph√™ Nh·ªè Gi·ªçt Cold Brew",
                price: "669.000ƒë",
                image: "https://images.unsplash.com/photo-1611564635773-3217d88450ed?w=300&h=200&fit=crop",
                url: "https://s.shopee.vn/10tawi2iQS",
                badge: "Premium"
            },
            {
                name: "H≈© ƒê·ª±ng C√† Ph√™ Ch·ªëng Oxy H√≥a",
                price: "Xem gi√°",
                image: "https://images.unsplash.com/photo-1587734195503-904fca47e7d9?w=300&h=200&fit=crop",
                url: "https://s.shopee.vn/5pz01sG37t",
                badge: "Ti·ªán d·ª•ng"
            },
            {
                name: "B·ªô Pha C√† Ph√™ Phin Truy·ªÅn Th·ªëng",
                price: "125.000ƒë",
                image: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=300&h=200&fit=crop",
                url: "https://s.shopee.vn/sample5",
                badge: "Truy·ªÅn th·ªëng"
            },
            {
                name: "M√°y Xay C√† Ph√™ C·∫ßm Tay",
                price: "299.000ƒë",
                image: "https://images.unsplash.com/photo-1504627298434-2119687def7e?w=300&h=200&fit=crop",
                url: "https://s.shopee.vn/sample6",
                badge: "Ti·ªán l·ª£i"
            }
        ];

        // ====================================================================
        // üîí SECURITY UTILITIES (From Document 1)
        // ====================================================================

        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function isValidImageUrl(url) {
            if (!url || typeof url !== 'string') return false;
            
            try {
                const urlObj = new URL(url);
                return (urlObj.protocol === 'https:' || urlObj.protocol === 'http:') &&
                       urlObj.hostname &&
                       !url.startsWith('javascript:') &&
                       !url.startsWith('data:');
            } catch (e) {
                return false;
            }
        }

        function sanitizeUrl(url) {
            if (!url || typeof url !== 'string') return '';
            
            try {
                const urlObj = new URL(url);
                if (urlObj.protocol === 'https:' || urlObj.protocol === 'http:') {
                    return url;
                }
            } catch (e) {
                // Invalid URL
            }
            return '';
        }

        // ====================================================================
        // üîç SHOPEE EXTRACTION FUNCTIONS (From Document 1)
        // ====================================================================

        function extractShopeeProducts(html, postTitle) {
            const products = [];
            
            if (!html || !postTitle) return products;
            
            // Enhanced patterns to find Shopee links including s.shopee.vn
            const shopeeLinkPatterns = [
                /https?:\/\/(?:www\.)?shopee\.vn\/[^\s"'<>)]+/gi,
                /https?:\/\/(?:www\.)?shp\.ee\/[^\s"'<>)]+/gi,
                /https?:\/\/s\.shopee\.vn\/[^\s"'<>)]+/gi,
                /<a[^>]*href=["'](https?:\/\/(?:www\.)?shopee\.vn\/[^"']+)["'][^>]*>/gi,
                /<a[^>]*href=["'](https?:\/\/(?:www\.)?shp\.ee\/[^"']+)["'][^>]*>/gi,
                /<a[^>]*href=["'](https?:\/\/s\.shopee\.vn\/[^"']+)["'][^>]*>/gi
            ];
            
            const foundLinks = new Set();
            
            // Extract all Shopee links
            for (const pattern of shopeeLinkPatterns) {
                let match;
                while ((match = pattern.exec(html)) !== null) {
                    const link = match[1] || match[0];
                    const sanitizedLink = sanitizeUrl(link);
                    if (sanitizedLink && !foundLinks.has(sanitizedLink)) {
                        foundLinks.add(sanitizedLink);
                    }
                }
            }
            
            // Also search for s.shopee.vn in plain text
            const shortLinkMatches = html.match(/https?:\/\/s\.shopee\.vn\/[A-Za-z0-9]+/gi);
            if (shortLinkMatches) {
                shortLinkMatches.forEach(link => {
                    const sanitizedLink = sanitizeUrl(link);
                    if (sanitizedLink && !foundLinks.has(sanitizedLink)) {
                        foundLinks.add(sanitizedLink);
                    }
                });
            }
            
            if (foundLinks.size === 0) {
                return [];
            }
            
            const images = extractProductImages(html);
            
            Array.from(foundLinks).forEach((link, index) => {
                const productName = extractProductNameFromLink(link, html, postTitle);
                const price = extractPriceFromContent(html, link);
                
                products.push({
                    name: escapeHtml(productName),
                    price: escapeHtml(price || "Xem gi√° tr√™n Shopee"),
                    url: link,
                    image: images[index % images.length] || null,
                    badge: "T·ª´ b√†i vi·∫øt",
                    postTitle: escapeHtml(postTitle)
                });
            });
            
            return products.slice(0, SHOPEE_CONFIG.maxProductsPerPost);
        }

        function extractProductImages(html) {
            const images = [];
            
            if (!html) return images;
            
            const imagePatterns = [
                /<img[^>]+src=["']([^"']+)["'][^>]*>/gi,
                /<meta\s+property="og:image"\s+content="([^"]+)"/gi,
                /background-image\s*:\s*url\(['"]?([^'"]+)['"]?\)/gi
            ];
            
            for (const pattern of imagePatterns) {
                let match;
                while ((match = pattern.exec(html)) !== null) {
                    const imageUrl = match[1];
                    if (isValidImageUrl(imageUrl) && 
                        imageUrl.length > 20 &&
                        !images.includes(imageUrl)) {
                        images.push(imageUrl);
                    }
                }
            }
            
            return images;
        }

        function extractProductNameFromLink(link, html, postTitle) {
            try {
                const urlObj = new URL(link);
                const pathParts = urlObj.pathname.split('/');
                
                for (const part of pathParts) {
                    if (part.length > 10 && part.includes('-')) {
                        const decoded = decodeURIComponent(part.replace(/-/g, ' '))
                                       .replace(/\b\w/g, l => l.toUpperCase())
                                       .substring(0, 50);
                        if (decoded && decoded.trim()) {
                            return decoded.trim();
                        }
                    }
                }
            } catch (e) {
                // URL parsing failed
            }
            
            if (html && html.indexOf) {
                const linkIndex = html.indexOf(link);
                if (linkIndex > -1) {
                    const before = html.substring(Math.max(0, linkIndex - 200), linkIndex);
                    const after = html.substring(linkIndex, linkIndex + 200);
                    
                    const namePatterns = [
                        /<a[^>]*>[^<]*([^<]{10,50})[^<]*<\/a>/i,
                        /alt=["']([^"']{10,50})["']/i,
                        /title=["']([^"']{10,50})["']/i
                    ];
                    
                    for (const pattern of namePatterns) {
                        const match = (before + after).match(pattern);
                        if (match && match[1] && match[1].trim()) {
                            return match[1].trim().substring(0, 50);
                        }
                    }
                }
            }
            
            return `${postTitle.substring(0, 30)} - S·∫£n ph·∫©m`;
        }

        function extractPriceFromContent(html, link) {
            if (!html || !link) return null;
            
            const linkIndex = html.indexOf(link);
            if (linkIndex === -1) return null;
            
            const searchText = html.substring(
                Math.max(0, linkIndex - 300), 
                linkIndex + 300
            );
            
            const pricePatterns = [
                /(\d{1,3}(?:[,.]?\d{3})*)\s*(?:ƒë|dong|vnd|‚Ç´)/gi,
                /(\d{1,3}(?:[,.]?\d{3})*)\s*(?:ngh√¨n|k)/gi,
                /gi√°\s*:?\s*(\d{1,3}(?:[,.]?\d{3})*)/gi,
                /price\s*:?\s*(\d{1,3}(?:[,.]?\d{3})*)/gi
            ];
            
            for (const pattern of pricePatterns) {
                const match = searchText.match(pattern);
                if (match && match[1]) {
                    const price = match[1] || match[0];
                    return price.includes('ƒë') ? price : `${price}ƒë`;
                }
            }
            
            return null;
        }

        // ====================================================================
        // üì± MOBILE/DESKTOP DETECTION (From Document 1)
        // ====================================================================

        function checkIfMobile() {
            isMobile = window.innerWidth <= 768;
            return isMobile;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // ====================================================================
        // üé® RENDERING FUNCTIONS (From Document 1)
        // ====================================================================

        function renderShopeeProducts(containerId = 'shopeeProducts', widgetId = 'shopeeWidget') {
            const shopeeWidget = document.getElementById(widgetId);
            const shopeeProducts = document.getElementById(containerId);
            
            if (!shopeeWidget || !shopeeProducts) return;
            
            checkIfMobile();
            
            // Use extracted products from posts if available, fallback to demo
            let productsToShow = extractedShopeeProducts.length > 0 ? 
                [...extractedShopeeProducts] : 
                [...demoShopeeProducts];
            
            shopeeWidget.style.display = 'block';
            
            if (isMobile) {
                // Mobile: Carousel with single product
                shopeeProducts.className = 'shopee-products mobile-carousel';
                currentProductIndex = 0;
                
                shopeeProducts.innerHTML = `
                    <button class="shopee-refresh-btn" onclick="nextProduct()">üîÑ S·∫£n ph·∫©m kh√°c</button>
                    <div class="mobile-carousel-container" id="carouselContainer">
                        ${productsToShow.map((product, index) => renderSingleProduct(product, index)).join('')}
                    </div>
                    <div class="carousel-indicators" id="carouselIndicators">
                        ${productsToShow.map((_, index) => 
                            `<div class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="goToProduct(${index})"></div>`
                        ).join('')}
                    </div>
                    <div class="carousel-navigation">
                        <button class="carousel-nav-btn" onclick="prevProduct()">‚Äπ</button>
                        <button class="carousel-nav-btn" onclick="nextProduct()">‚Ä∫</button>
                    </div>
                `;
                
                updateCarouselPosition();
                addTouchSupport();
                
            } else {
                // Desktop: 3 random products
                shopeeProducts.className = 'shopee-products';
                const randomProducts = shuffleArray(productsToShow).slice(0, SHOPEE_CONFIG.desktopProductsCount);
                
                shopeeProducts.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; margin-bottom: 15px;">
                        <button class="shopee-refresh-btn" onclick="refreshDesktopProducts()">üîÑ S·∫£n ph·∫©m kh√°c</button>
                    </div>
                    ${randomProducts.map((product, index) => renderSingleProduct(product, index)).join('')}
                `;
            }
        }

        function renderSingleProduct(product, index) {
            if (!product || !product.url) return '';
            
            const imageContent = product.image && isValidImageUrl(product.image) ? 
                `<img src="${escapeHtml(product.image)}" alt="${escapeHtml(product.name || 'S·∫£n ph·∫©m')}" onerror="this.parentElement.innerHTML='‚òï';">` : 
                '‚òï';
            
            return `
                <div class="shopee-product" onclick="window.open('${escapeHtml(product.url)}', '_blank', 'noopener,noreferrer')">
                    ${product.discount ? `<div class="shopee-discount">${escapeHtml(product.discount)}</div>` : ''}
                    <div class="shopee-product-image">
                        ${imageContent}
                    </div>
                    <div class="shopee-product-info">
                        <div class="shopee-product-name">${escapeHtml(product.name || 'S·∫£n ph·∫©m')}</div>
                        <div class="shopee-product-price">
                            ${escapeHtml(product.price || 'Xem gi√°')}
                            ${product.oldPrice ? `<span class="shopee-product-old-price">${escapeHtml(product.oldPrice)}</span>` : ''}
                        </div>
                        <button class="shopee-cta-button" onclick="event.stopPropagation(); window.open('${escapeHtml(product.url)}', '_blank', 'noopener,noreferrer')">
                            üõí Mua ngay
                        </button>
                    </div>
                    <div class="shopee-badge">${escapeHtml(product.badge || 'S·∫£n ph·∫©m')}</div>
                </div>
            `;
        }

        // ====================================================================
        // üéÆ NAVIGATION FUNCTIONS (From Document 1)
        // ====================================================================

        function updateCarouselPosition() {
            const container = document.getElementById('carouselContainer');
            const indicators = document.querySelectorAll('.carousel-dot');
            
            if (container) {
                container.style.transform = `translateX(-${currentProductIndex * 100}%)`;
            }
            
            indicators.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentProductIndex);
            });
        }

        function nextProduct() {
            if (!isMobile) return;
            currentProductIndex = (currentProductIndex + 1) % demoShopeeProducts.length;
            updateCarouselPosition();
        }

        function prevProduct() {
            if (!isMobile) return;
            currentProductIndex = (currentProductIndex - 1 + demoShopeeProducts.length) % demoShopeeProducts.length;
            updateCarouselPosition();
        }

        function goToProduct(index) {
            if (!isMobile) return;
            currentProductIndex = index;
            updateCarouselPosition();
        }

        function refreshDesktopProducts() {
            if (isMobile) return;
            
            const randomProducts = shuffleArray(demoShopeeProducts).slice(0, SHOPEE_CONFIG.desktopProductsCount);
            const productContainer = document.getElementById('shopeeProducts');
            
            if (!productContainer) return;
            
            const newProductsHTML = randomProducts.map((product, index) => renderSingleProduct(product, index)).join('');
            productContainer.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; margin-bottom: 15px;">
                    <button class="shopee-refresh-btn" onclick="refreshDesktopProducts()">üîÑ S·∫£n ph·∫©m kh√°c</button>
                </div>
                ${newProductsHTML}
            `;
        }

        // ====================================================================
        // üëÜ TOUCH SUPPORT (From Document 1)
        // ====================================================================

        function addTouchSupport() {
            const container = document.getElementById('carouselContainer');
            if (!container) return;
            
            let startX = 0;
            let startY = 0;
            let isDragging = false;
            
            const handleStart = (e) => {
                isDragging = true;
                const touch = e.touches ? e.touches[0] : e;
                startX = touch.clientX;
                startY = touch.clientY;
            };
            
            const handleMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();
            };
            
            const handleEnd = (e) => {
                if (!isDragging) return;
                isDragging = false;
                
                const touch = e.changedTouches ? e.changedTouches[0] : e;
                const endX = touch.clientX;
                const endY = touch.clientY;
                
                const deltaX = startX - endX;
                const deltaY = startY - endY;
                
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                    if (deltaX > 0) {
                        nextProduct();
                    } else {
                        prevProduct();
                    }
                }
            };
            
            container.addEventListener('touchstart', handleStart, { passive: true });
            container.addEventListener('touchmove', handleMove, { passive: false });
            container.addEventListener('touchend', handleEnd, { passive: true });
            
            container.addEventListener('mousedown', handleStart);
            container.addEventListener('mousemove', handleMove);
            container.addEventListener('mouseup', handleEnd);
            container.addEventListener('mouseleave', handleEnd);
        }

        // ====================================================================
        // üîÑ RESPONSIVE HANDLER (From Document 1)
        // ====================================================================

        function handleWindowResize() {
            const wasMobile = isMobile;
            checkIfMobile();
            
            if (wasMobile !== isMobile) {
                renderShopeeProducts();
            }
        }

        function processShopeeProducts(allPosts) {
            extractedShopeeProducts = [];
            
            if (!Array.isArray(allPosts)) return;
            
            allPosts.forEach(post => {
                if (post && Array.isArray(post.shopeeProducts)) {
                    extractedShopeeProducts.push(...post.shopeeProducts);
                }
            });
            
            console.log(`üõí Extracted ${extractedShopeeProducts.length} Shopee products from posts`);
        }

        // ====================================================================
        // üöÄ INITIALIZATION (From Document 1)
        // ====================================================================

        function initShopeeWidget() {
            // Expose functions to global scope
            window.nextProduct = nextProduct;
            window.prevProduct = prevProduct;
            window.goToProduct = goToProduct;
            window.refreshDesktopProducts = refreshDesktopProducts;
            
            // Add keyboard support
            document.addEventListener('keydown', (e) => {
                if (isMobile) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        prevProduct();
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        nextProduct();
                    }
                }
            });
            
            // Add resize listener
            const debounce = (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            };
            
            window.addEventListener('resize', debounce(handleWindowResize, 300));
            
            console.log('üõí Shopee Widget initialized');
        }

        // ====================================================================
        // üîß ORIGINAL BLOG CONFIGURATION (From Document 2)
        // ====================================================================
        
        const POSTS_FOLDER = './posts/';
        const AUTO_SCAN = false;
        const POSTS_PER_PAGE = 5;
        
        // Fixed and verified post filenames
        const manualPosts = [
            'cach-chon-hat-ca-phe-danh-cho-pha-may.html',
            'cac-muc-rang-ca-phe.html', 
            'cach-bao-quan-ca-phe.html',
            'arabica-robusta-blog.html',
            'cach-pha-ca-phe-phin.html',
            'bai-viet-dau-tien.html',
        ];

        // ====================================================================
        // üéØ GLOBAL VARIABLES (From Document 2)
        // ====================================================================
        
        let allPosts = [];
        let filteredPosts = [];
        let currentFilter = 'all';
        let currentPage = 1;
        let totalPages = 1;
        let filterCache = new Map(); // Cache for filter results

        // Cached DOM Elements for performance
        const DOM = {
            featuredPost: document.getElementById('featuredPost'),
            postsGrid: document.getElementById('postsGrid'),
            searchInput: document.getElementById('searchInput'),
            mobileSearchInput: document.getElementById('mobileSearchInput'),
            filterDropdown: document.getElementById('filterDropdown'),
            filterOptions: document.getElementById('filterOptions'),
            selectedFilter: document.getElementById('selectedFilter'),
            shopeeProducts: document.getElementById('shopeeProducts'),
            shopeeWidget: document.getElementById('shopeeWidget'),
            noResults: document.getElementById('noResults'),
            totalPostsEl: document.getElementById('totalPosts'),
            totalTagsEl: document.getElementById('totalTags'),
            loading: document.getElementById('loading'),
            refreshBtn: document.getElementById('refreshBtn'),
            mobileRefreshBtn: document.getElementById('mobileRefreshBtn'),
            pagination: document.getElementById('pagination'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            paginationInfo: document.getElementById('paginationInfo')
        };

        // ====================================================================
        // üîç METADATA PARSING FUNCTIONS (ENHANCED)
        // ====================================================================

        // Enhanced metadata parser - KEEP ORIGINAL LOGIC, only add safety checks
        function parsePostMetadata(html, filename) {
            console.log(`üîç Parsing metadata for: ${filename}`);
            const metadata = {};
            
            // Method 1: HTML Comments
            const commentPatterns = [
                /<!--\s*([\s\S]*?)\s*-->/g,
                /\/\*\s*([\s\S]*?)\s*\*\//g
            ];
            
            for (const pattern of commentPatterns) {
                let match;
                while ((match = pattern.exec(html)) !== null) {
                    const content = match[1];
                    const lines = content.split('\n');
                    
                    for (const line of lines) {
                        const keyValue = line.match(/(\w+):\s*(.+)/);
                        if (keyValue) {
                            const key = keyValue[1].toLowerCase();
                            const value = keyValue[2].trim();
                            
                            if (key === 'tags' && value) {
                                metadata.tags = value.split(',').map(tag => tag.trim().toLowerCase());
                            } else if (key === 'title') {
                                metadata.title = value;
                            } else if (key === 'excerpt' || key === 'description') {
                                metadata.excerpt = value;
                            } else if (key === 'date') {
                                metadata.date = value;
                            } else if (key === 'readtime' || key === 'reading-time') {
                                metadata.readTime = value;
                            }
                        }
                    }
                }
            }
            
            // Method 2: Meta tags
            const metaPatterns = [
                { pattern: /<meta\s+name=["']keywords["']\s+content=["']([^"']+)["']/i, key: 'tags' },
                { pattern: /<meta\s+name=["']description["']\s+content=["']([^"']+)["']/i, key: 'excerpt' },
                { pattern: /<meta\s+property=["']og:title["']\s+content=["']([^"']+)["']/i, key: 'title' },
                { pattern: /<meta\s+property=["']og:description["']\s+content=["']([^"']+)["']/i, key: 'excerpt' },
                { pattern: /<meta\s+name=["']tags["']\s+content=["']([^"']+)["']/i, key: 'tags' },
                { pattern: /<meta\s+name=["']post-tags["']\s+content=["']([^"']+)["']/i, key: 'tags' }
            ];
            
            for (const { pattern, key } of metaPatterns) {
                const match = html.match(pattern);
                if (match) {
                    console.log(`üè∑Ô∏è Found meta tag: ${key} = ${match[1]}`);
                    if (key === 'tags') {
                        metadata.tags = match[1].split(',').map(tag => tag.trim().toLowerCase());
                    } else {
                        metadata[key] = match[1];
                    }
                }
            }
            
            // Method 3: JSON-LD structured data
            const jsonLdMatch = html.match(/<script[^>]*type=["']application\/ld\+json["'][^>]*>([\s\S]*?)<\/script>/i);
            if (jsonLdMatch) {
                try {
                    const jsonData = JSON.parse(jsonLdMatch[1]);
                    console.log(`üìä Found JSON-LD data:`, jsonData);
                    
                    if (jsonData.keywords) {
                        if (typeof jsonData.keywords === 'string') {
                            metadata.tags = jsonData.keywords.split(',').map(tag => tag.trim().toLowerCase());
                        } else if (Array.isArray(jsonData.keywords)) {
                            metadata.tags = jsonData.keywords.map(tag => tag.toLowerCase());
                        }
                    }
                    
                    if (jsonData.headline && !metadata.title) metadata.title = jsonData.headline;
                    if (jsonData.description && !metadata.excerpt) metadata.excerpt = jsonData.description;
                    if (jsonData.datePublished && !metadata.date) metadata.date = jsonData.datePublished;
                } catch (e) {
                    console.log(`‚ùå JSON-LD parse error:`, e);
                }
            }
            
            // Method 4: Data attributes or special divs
            const dataPatterns = [
                /data-tags=["']([^"']+)["']/i,
                /<div\s+class=["']post-tags["'][^>]*>([^<]*)</i,
                /<span\s+class=["']tags["'][^>]*>([^<]*)</i
            ];
            
            for (const pattern of dataPatterns) {
                const match = html.match(pattern);
                if (match && match[1].trim()) {
                    console.log(`üè∑Ô∏è Found data tags: ${match[1]}`);
                    metadata.tags = match[1].split(',').map(tag => tag.trim().toLowerCase());
                    break;
                }
            }
            
            // Method 5: Fallback - analyze content for Vietnamese coffee terms
            if (!metadata.tags || metadata.tags.length === 0) {
                console.log(`üîç No tags found, analyzing content...`);
                metadata.tags = analyzeContentForTags(html, filename);
            }
            
            // Extract title
            if (!metadata.title) {
                const titleMatch = html.match(/<title>([^<]+)<\/title>/i);
                if (titleMatch) {
                    metadata.title = titleMatch[1].trim();
                } else {
                    // Fallback to h1
                    const h1Match = html.match(/<h1[^>]*>([^<]+)<\/h1>/i);
                    if (h1Match) metadata.title = h1Match[1].trim();
                }
            }
            
            // Extract excerpt
            if (!metadata.excerpt) {
                // Try to find first meaningful paragraph
                const paragraphMatches = html.match(/<p[^>]*>([^<]+)<\/p>/gi);
                if (paragraphMatches) {
                    for (const p of paragraphMatches) {
                        const content = p.replace(/<[^>]*>/g, '').trim();
                        if (content.length > 50) {
                            metadata.excerpt = content.substring(0, 150) + '...';
                            break;
                        }
                    }
                }
            }
            
            // Extract first image
            const firstImage = extractFirstImage(html);
            if (firstImage) {
                metadata.image = firstImage;
                metadata.imageType = 'image';
            }
            
            // Set defaults
            metadata.title = metadata.title || `B√†i vi·∫øt ${filename.replace('.html', '')}`;
            metadata.excerpt = metadata.excerpt || 'ƒê·ªçc b√†i vi·∫øt ƒë·ªÉ kh√°m ph√° th√™m...';
            metadata.tags = metadata.tags && metadata.tags.length > 0 ? metadata.tags : ['coffee'];
            metadata.date = metadata.date || new Date().toISOString().split('T')[0];
            metadata.readTime = metadata.readTime || '5 ph√∫t ƒë·ªçc';
            
            if (!metadata.image) {
                metadata.image = getEmojiForTags(metadata.tags);
                metadata.imageType = 'emoji';
            }
            
            console.log(`‚úÖ Final metadata for ${filename}:`, metadata);
            return metadata;
        }

        // Get default metadata when parsing fails
        function getDefaultMetadata(filename) {
            return {
                title: `B√†i vi·∫øt ${filename.replace('.html', '')}`,
                excerpt: 'ƒê·ªçc b√†i vi·∫øt ƒë·ªÉ kh√°m ph√° th√™m...',
                tags: ['coffee'],
                date: new Date().toISOString().split('T')[0],
                readTime: '5 ph√∫t ƒë·ªçc',
                image: '‚òï',
                imageType: 'emoji'
            };
        }

        // AI-powered content analysis for tag extraction (enhanced)
        function analyzeContentForTags(html, filename) {
            const tags = [];
            
            if (!html || !filename) return ['coffee'];
            
            const content = html.toLowerCase();
            
            // Vietnamese coffee terms mapping
            const termMap = {
                'brewing': ['pha ch·∫ø', 'pha c√† ph√™', 'c√°ch pha', 'brewing', 'drip', 'pour over'],
                'equipment': ['m√°y pha', 'phin', 'espresso machine', 'grinder', 'd·ª•ng c·ª•', 'thi·∫øt b·ªã'],
                'origin': ['ngu·ªìn g·ªëc', 'xu·∫•t x·ª©', 'v√πng tr·ªìng', 'origin', 'farm', 'plantation'],
                'vietnamese': ['vi·ªát nam', 'vietnamese', 'vn coffee', 'c√† ph√™ vi·ªát'],
                'arabica': ['arabica'],
                'robusta': ['robusta'],
                'specialty': ['specialty', 'ƒë·∫∑c bi·ªát', 'cao c·∫•p', 'premium'],
                'culture': ['vƒÉn h√≥a', 'culture', 'truy·ªÅn th·ªëng', 'tradition'],
                'health': ['s·ª©c kh·ªèe', 'health', 'l·ª£i √≠ch', 'benefit'],
                'review': ['ƒë√°nh gi√°', 'review', 'tasting', 'th·ª≠'],
                'tips': ['m·∫πo', 'tips', 'b√≠ quy·∫øt', 'h∆∞·ªõng d·∫´n', 'c√°ch'],
                'cold': ['cold brew', 'c√† ph√™ l·∫°nh', 'iced coffee', 'l·∫°nh'],
                'latte': ['latte', 's·ªØa'],
                'espresso': ['espresso'],
                'phin': ['phin'],
                'b·∫£o qu·∫£n c√† ph√™': ['b·∫£o qu·∫£n', 'l∆∞u tr·ªØ', 'storage'],
                'rang c√† ph√™': ['rang', 'roast', 'roasting'],
                'light roast': ['rang nh·∫π', 'light roast'],
                'medium roast': ['rang v·ª´a', 'medium roast'],
                'dark roast': ['rang ƒë·∫≠m', 'dark roast']
            };
            
            // Analyze filename first
            const filenameLower = filename.toLowerCase();
            Object.entries(termMap).forEach(([tag, terms]) => {
                if (terms.some(term => filenameLower.includes(term))) {
                    tags.push(tag);
                }
            });
            
            // Analyze content
            Object.entries(termMap).forEach(([tag, terms]) => {
                const score = terms.reduce((acc, term) => {
                    const matches = (content.match(new RegExp(term, 'g')) || []).length;
                    return acc + matches;
                }, 0);
                
                if (score >= 2 || (score >= 1 && terms.some(term => filenameLower.includes(term)))) {
                    if (!tags.includes(tag)) {
                        tags.push(tag);
                    }
                }
            });
            
            // Always include 'coffee' as base tag if no other tags found
            if (tags.length === 0) {
                tags.push('coffee');
            }
            
            return tags;
        }

        // Extract first image URL from HTML content (enhanced)
        function extractFirstImage(html) {
            if (!html) return null;
            
            const patterns = [
                /<meta\s+property="og:image"\s+content="([^"]+)"/i,
                /<meta\s+name="twitter:image"\s+content="([^"]+)"/i,
                /<img[^>]+src="([^"]+)"[^>]*>/i,
                /background(-image)?\s*:\s*url\(['"]?([^'"]+)['"]?\)/i,
                /\.hero-image[^}]*background[^}]*url\(['"]?([^'"]+)['"]?\)/i,
                /\.content-image[^}]*background[^}]*url\(['"]?([^'"]+)['"]?\)/i
            ];

            for (const pattern of patterns) {
                const match = html.match(pattern);
                if (match) {
                    let imageUrl = match[1] || match[2] || match[3];
                    if (imageUrl) {
                        imageUrl = imageUrl.trim();
                        if (isValidImageUrl(imageUrl)) {
                            return imageUrl;
                        }
                    }
                }
            }
            
            return null;
        }

        // Get appropriate emoji for tags
        function getEmojiForTags(tags) {
            if (!Array.isArray(tags)) return 'üìÑ';
            
            const emojiMap = {
                'brewing': '‚òï',
                'tips': 'üí°', 
                'culture': 'üèõÔ∏è',
                'origin': 'üå±',
                'review': '‚≠ê',
                'equipment': '‚öôÔ∏è',
                'coffee': '‚òï',
                'latte': 'ü•õ',
                'espresso': 'üáÆüáπ',
                'cold': 'üßä',
                'health': 'üí™',
                'specialty': '‚≠ê',
                'vietnamese': 'üáªüá≥',
                'arabica': 'üåø',
                'robusta': 'üí™',
                'phin': '‚òï',
                'b·∫£o qu·∫£n c√† ph√™': 'üì¶',
                'rang c√† ph√™': 'üî•',
                'light roast': 'üåÖ',
                'medium roast': '‚òÄÔ∏è',
                'dark roast': 'üåö'
            };
            
            for (const tag of tags) {
                if (tag && emojiMap[tag.toLowerCase()]) {
                    return emojiMap[tag.toLowerCase()];
                }
            }
            
            return 'üìÑ';
        }

        // ====================================================================
        // üìñ POST LOADING FUNCTIONS (ENHANCED)
        // ====================================================================

        // Load metadata from individual post file (enhanced with error handling)
        async function loadPostMetadata(filepath, id) {
            try {
                console.log(`üìÑ Loading post: ${filepath}`);
                
                const response = await fetch(filepath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - ${response.statusText}`);
                }
                
                const html = await response.text();
                const filename = filepath.split('/').pop();
                const metadata = parsePostMetadata(html, filename);
                
                // Extract Shopee products from this post
                const shopeeProducts = extractShopeeProducts(html, metadata.title);
                
                return {
                    id: id,
                    title: escapeHtml(metadata.title),
                    excerpt: escapeHtml(metadata.excerpt),
                    tags: metadata.tags || ['coffee'],
                    date: metadata.date,
                    readTime: escapeHtml(metadata.readTime),
                    image: metadata.image,
                    imageType: metadata.imageType,
                    link: sanitizeUrl(filepath) || filepath,
                    shopeeProducts: shopeeProducts
                };
            } catch (error) {
                console.error(`‚ùå Error loading ${filepath}:`, error);
                return null;
            }
        }

        // Load posts from manual list (enhanced)
        async function loadManualPosts() {            
            if (!Array.isArray(manualPosts) || manualPosts.length === 0) {
                console.log('üìù No manual posts configured');
                return [];
            }
            
            const posts = [];
            console.log(`üìö Loading ${manualPosts.length} manual posts...`);
            
            const loadPromises = manualPosts.map(async (filename, index) => {
                try {
                    if (!filename || typeof filename !== 'string') {
                        console.warn(`‚ö†Ô∏è Invalid filename at index ${index}:`, filename);
                        return null;
                    }
                    
                    const postData = await loadPostMetadata(POSTS_FOLDER + filename, index + 1);
                    if (postData) {
                        console.log(`‚úÖ Loaded: ${postData.title}`);
                        return postData;
                    }
                    return null;
                } catch (error) {
                    console.error(`‚ùå Failed to load: ${filename}`, error);
                    return null;
                }
            });
            
            const results = await Promise.all(loadPromises);
            const validPosts = results.filter(post => post !== null);
            
            console.log(`üìä Successfully loaded ${validPosts.length}/${manualPosts.length} posts`);
            return validPosts;
        }

        // ====================================================================
        // üé® RENDERING FUNCTIONS (ENHANCED)
        // ====================================================================

        // Render featured post (first/newest post) with security enhancements
        function renderFeaturedPost() {
            if (!DOM.featuredPost) return;
            
            if (!Array.isArray(filteredPosts) || filteredPosts.length === 0) {
                DOM.featuredPost.innerHTML = `
                    <div class="featured-content">
                        <div class="no-results">
                            <div class="no-results-icon">üìù</div>
                            <h3>Ch∆∞a c√≥ b√†i vi·∫øt n·ªïi b·∫≠t</h3>
                            <p>H√£y th√™m b√†i vi·∫øt ƒë·ªÉ hi·ªÉn th·ªã ·ªü ƒë√¢y</p>
                        </div>
                    </div>
                `;
                return;
            }

            const post = filteredPosts[0];
            if (!post) return;

            const imageContent = post.imageType === 'image' && isValidImageUrl(post.image) ? 
                `<img src="${escapeHtml(post.image)}" alt="${escapeHtml(post.title)}" onerror="this.parentElement.innerHTML='${getEmojiForTags(post.tags)}'; this.parentElement.classList.add('emoji');">` : 
                escapeHtml(post.image || 'üìÑ');

            DOM.featuredPost.innerHTML = `
                <div class="featured-image ${post.imageType === 'emoji' ? 'emoji' : ''}">
                    ${imageContent}
                </div>
                <div class="featured-content">
                    <div class="featured-meta">
                        <span class="featured-date">${escapeHtml(formatDate(post.date))}</span>
                        <span class="featured-reading-time">
                            üìñ ${post.readTime || '5 ph√∫t ƒë·ªçc'}
                        </span>
                    </div>
                    <h2 class="featured-title">
                        <a href="${escapeHtml(post.link)}">${post.title}</a>
                    </h2>
                    <p class="featured-excerpt">${post.excerpt}</p>
                    <div class="featured-tags">
                        ${Array.isArray(post.tags) ? post.tags.map(tag => 
                            `<span class="featured-tag" data-tag="${escapeHtml(tag)}">${escapeHtml(getDisplayName(tag))}</span>`
                        ).join('') : ''}
                    </div>
                </div>
            `;

            // Add click handlers for featured tags
            DOM.featuredPost.querySelectorAll('.featured-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tagValue = tag.dataset.tag;
                    if (tagValue) {
                        filterByTag(tagValue);
                    }
                });
            });
        }

        // Render posts grid (excluding featured post) with security enhancements
        function renderPosts() {
            if (!DOM.postsGrid || !DOM.noResults || !DOM.pagination) return;
            
            const startIndex = currentFilter === 'all' && Array.isArray(filteredPosts) && filteredPosts.length > 0 ? 1 : 0;
            const postsToShow = Array.isArray(filteredPosts) ? filteredPosts.slice(startIndex) : [];
            
            // Calculate pagination
            totalPages = Math.ceil(postsToShow.length / POSTS_PER_PAGE);
            const startIdx = (currentPage - 1) * POSTS_PER_PAGE;
            const endIdx = startIdx + POSTS_PER_PAGE;
            const currentPosts = postsToShow.slice(startIdx, endIdx);

            if (currentPosts.length === 0 && startIndex === 0) {
                DOM.postsGrid.style.display = 'none';
                DOM.noResults.style.display = 'block';
                DOM.pagination.style.display = 'none';
                return;
            }

            DOM.postsGrid.style.display = 'grid';
            DOM.noResults.style.display = 'none';

            DOM.postsGrid.innerHTML = currentPosts.map(post => {
                if (!post) return '';
                
                const imageContent = post.imageType === 'image' && isValidImageUrl(post.image) ? 
                    `<img src="${escapeHtml(post.image)}" alt="${escapeHtml(post.title)}" onerror="this.parentElement.innerHTML='${getEmojiForTags(post.tags)}'; this.parentElement.classList.add('emoji');">` : 
                    escapeHtml(post.image || 'üìÑ');

                return `
                    <article class="post-card fade-in">
                        <div class="post-image ${post.imageType === 'emoji' ? 'emoji' : ''}">
                            ${imageContent}
                        </div>
                        <div class="post-content">
                            <div class="post-meta">
                                <span class="post-date">${escapeHtml(formatDate(post.date))}</span>
                                <span class="post-reading-time">
                                    üìñ ${post.readTime || '5 ph√∫t ƒë·ªçc'}
                                </span>
                            </div>
                            <h2 class="post-title">
                                <a href="${escapeHtml(post.link)}">${post.title}</a>
                            </h2>
                            <p class="post-excerpt">${post.excerpt}</p>
                            <div class="post-tags">
                                ${Array.isArray(post.tags) ? post.tags.map(tag => 
                                    `<span class="post-tag" data-tag="${escapeHtml(tag)}">${escapeHtml(getDisplayName(tag))}</span>`
                                ).join('') : ''}
                            </div>
                        </div>
                    </article>
                `;
            }).join('');

            // Add click handlers for post tags
            DOM.postsGrid.querySelectorAll('.post-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tagValue = tag.dataset.tag;
                    if (tagValue) {
                        filterByTag(tagValue);
                    }
                });
            });

            // Update pagination
            updatePagination();
        }

        // ====================================================================
        // üéØ FILTER & SEARCH FUNCTIONS (ENHANCED)
        // ====================================================================

        // Generate dynamic filter options with caching
        function generateFilterOptions() {
            if (!Array.isArray(allPosts) || !DOM.filterOptions) return;
            
            const allTags = [...new Set(allPosts.flatMap(post => 
                Array.isArray(post.tags) ? post.tags : []
            ))].filter(Boolean);
            
            // Keep the "T·∫•t c·∫£" option and add dynamic options
            DOM.filterOptions.innerHTML = '<div class="filter-option selected" data-tag="all">T·∫•t c·∫£</div>';
            
            allTags.sort().forEach(tag => {
                if (tag && typeof tag === 'string') {
                    const displayName = getDisplayName(tag);
                    const optionElement = document.createElement('div');
                    optionElement.className = 'filter-option';
                    optionElement.setAttribute('data-tag', escapeHtml(tag));
                    optionElement.textContent = displayName;
                    DOM.filterOptions.appendChild(optionElement);
                }
            });
            
            // Attach event listeners
            attachFilterOptionListeners();
        }

        // Get display name for tags (enhanced)
        function getDisplayName(tag) {
            if (!tag || typeof tag !== 'string') return 'Kh√¥ng r√µ';
            
            const displayNames = {
                'brewing': 'Pha ch·∫ø',
                'origin': 'Ngu·ªìn g·ªëc', 
                'review': 'ƒê√°nh gi√°',
                'tips': 'M·∫πo hay',
                'culture': 'VƒÉn h√≥a',
                'equipment': 'D·ª•ng c·ª•',
                'coffee': 'C√† ph√™',
                'vietnamese': 'Vi·ªát Nam',
                'arabica': 'Arabica',
                'robusta': 'Robusta',
                'specialty': 'ƒê·∫∑c bi·ªát',
                'health': 'S·ª©c kh·ªèe',
                'cold': 'L·∫°nh',
                'latte': 'Latte',
                'espresso': 'Espresso',
                'phin': 'Phin',
                'b·∫£o qu·∫£n c√† ph√™': 'B·∫£o qu·∫£n c√† ph√™',
                'c√°ch b·∫£o qu·∫£n c√† ph√™': 'C√°ch b·∫£o qu·∫£n',
                'c√† ph√™ h·∫°t': 'C√† ph√™ h·∫°t',
                'c√† ph√™ xay': 'C√† ph√™ xay',
                'h∆∞·ªõng d·∫´n c√† ph√™': 'H∆∞·ªõng d·∫´n',
                'rang c√† ph√™': 'Rang c√† ph√™',
                'c√°c m·ª©c rang c√† ph√™': 'C√°c m·ª©c rang',
                'light roast': 'Light roast',
                'medium roast': 'Medium roast', 
                'dark roast': 'Dark roast',
                'h∆∞∆°ng v·ªã c√† ph√™': 'H∆∞∆°ng v·ªã',
                'arabica vs robusta': 'Arabica vs Robusta',
                's·ª± kh√°c nhau arabica robusta': 'So s√°nh Arabica Robusta',
                'ph√¢n bi·ªát arabica robusta': 'Ph√¢n bi·ªát lo·∫°i h·∫°t',
                'c√† ph√™ arabica': 'C√† ph√™ Arabica',
                'c√† ph√™ robusta': 'C√† ph√™ Robusta'
            };
            
            const lowerTag = tag.toLowerCase();
            return displayNames[lowerTag] || (tag.charAt(0).toUpperCase() + tag.slice(1));
        }

        // Attach filter option listeners with enhanced error handling
        function attachFilterOptionListeners() {
            if (!DOM.filterOptions) return;
            
            const filterOptionElements = DOM.filterOptions.querySelectorAll('.filter-option');
            filterOptionElements.forEach(option => {
                option.addEventListener('click', (e) => {
                    try {
                        e.preventDefault();
                        
                        // Update selected option
                        filterOptionElements.forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                        
                        // Update dropdown display
                        if (DOM.selectedFilter) {
                            DOM.selectedFilter.textContent = option.textContent || 'T·∫•t c·∫£';
                        }
                        
                        // Hide dropdown
                        if (DOM.filterOptions && DOM.filterDropdown) {
                            DOM.filterOptions.classList.remove('show');
                            DOM.filterDropdown.classList.remove('active');
                        }
                        
                        // Filter posts
                        const tagValue = option.dataset.tag;
                        if (tagValue) {
                            filterByTag(tagValue);
                        }
                    } catch (error) {
                        console.error('Error in filter option click:', error);
                    }
                });
            });
        }

        // Filter by tag with caching
        function filterByTag(tag) {
            if (!tag || typeof tag !== 'string') return;
            
            // Reset page and apply filter
            currentPage = 1;
            currentFilter = tag;
            
            // Use cached result if available
            const cacheKey = `${tag}_${DOM.searchInput?.value || ''}`;
            if (filterCache.has(cacheKey)) {
                filteredPosts = filterCache.get(cacheKey);
                renderFeaturedPost();
                renderPosts();
                updateStats();
            } else {
                filterPosts();
            }
        }

        // Handle search with enhanced debouncing and validation
        function handleSearch(query = '') {
            if (typeof query !== 'string') query = '';
            
            const sanitizedQuery = query.toLowerCase().trim();
            
            // Sync search inputs
            if (DOM.searchInput && DOM.mobileSearchInput) {
                if (DOM.searchInput.value !== query) DOM.searchInput.value = query;
                if (DOM.mobileSearchInput.value !== query) DOM.mobileSearchInput.value = query;
            }
            
            filterPosts(sanitizedQuery);
        }

        // Main filter function with caching and performance optimization
        function filterPosts(searchQuery = '') {
            if (!Array.isArray(allPosts)) {
                filteredPosts = [];
                hideLoading();
                renderFeaturedPost();
                renderPosts();
                updateStats();
                return;
            }
            
            showLoading();
            
            // Use cache if available
            const cacheKey = `${currentFilter}_${searchQuery}`;
            if (filterCache.has(cacheKey)) {
                filteredPosts = filterCache.get(cacheKey);
                hideLoading();
                renderFeaturedPost();
                renderPosts();
                updateStats();
                return;
            }
            
            setTimeout(() => {
                try {
                    filteredPosts = allPosts.filter(post => {
                        if (!post) return false;
                        
                        const matchesTag = currentFilter === 'all' || 
                            (Array.isArray(post.tags) && post.tags.includes(currentFilter));
                        
                        const matchesSearch = searchQuery === '' || 
                            (post.title && post.title.toLowerCase().includes(searchQuery)) ||
                            (post.excerpt && post.excerpt.toLowerCase().includes(searchQuery)) ||
                            (Array.isArray(post.tags) && post.tags.some(tag => 
                                tag && tag.toLowerCase().includes(searchQuery)));
                        
                        return matchesTag && matchesSearch;
                    });

                    // Cache result
                    filterCache.set(cacheKey, [...filteredPosts]);
                    
                    // Limit cache size
                    if (filterCache.size > 50) {
                        const firstKey = filterCache.keys().next().value;
                        filterCache.delete(firstKey);
                    }

                    // Reset to first page when filtering
                    currentPage = 1;
                    
                } catch (error) {
                    console.error('Error in filterPosts:', error);
                    filteredPosts = [];
                } finally {
                    hideLoading();
                    renderFeaturedPost();
                    renderPosts();
                    updateStats();
                }
            }, 300);
        }

        // ====================================================================
        // üìÑ PAGINATION FUNCTIONS (ENHANCED)
        // ====================================================================

        // Update pagination UI with error handling
        function updatePagination() {
            if (!DOM.pagination || !DOM.prevBtn || !DOM.nextBtn || !DOM.paginationInfo) return;
            
            try {
                if (totalPages <= 1) {
                    DOM.pagination.style.display = 'none';
                    return;
                }

                DOM.pagination.style.display = 'flex';
                DOM.prevBtn.disabled = currentPage === 1;
                DOM.nextBtn.disabled = currentPage === totalPages;
                
                DOM.paginationInfo.textContent = `Trang ${currentPage} / ${totalPages}`;
            } catch (error) {
                console.error('Error updating pagination:', error);
            }
        }

        // Go to previous page with validation
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderPosts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Go to next page with validation
        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                renderPosts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ====================================================================
        // üéõÔ∏è UI UTILITY FUNCTIONS (ENHANCED)
        // ====================================================================

        // Update statistics with error handling
        function updateStats() {
            try {
                if (DOM.totalPostsEl) {
                    DOM.totalPostsEl.textContent = Array.isArray(allPosts) ? allPosts.length : 0;
                }
                
                if (DOM.totalTagsEl) {
                    const uniqueTags = Array.isArray(allPosts) ? 
                        [...new Set(allPosts.flatMap(post => 
                            Array.isArray(post.tags) ? post.tags : []
                        ))].filter(Boolean) : [];
                    DOM.totalTagsEl.textContent = uniqueTags.length;
                }
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Show loading state
        function showLoading() {
            if (DOM.loading) DOM.loading.style.display = 'block';
            if (DOM.postsGrid) DOM.postsGrid.style.display = 'none';
            if (DOM.noResults) DOM.noResults.style.display = 'none';
            if (DOM.pagination) DOM.pagination.style.display = 'none';
        }

        // Hide loading state
        function hideLoading() {
            if (DOM.loading) DOM.loading.style.display = 'none';
        }

        // Format date for display with validation
        function formatDate(dateString) {
            try {
                if (!dateString) return 'Kh√¥ng r√µ';
                
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'Kh√¥ng r√µ';
                
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 1) return 'H√¥m qua';
                if (diffDays <= 7) return `${diffDays} ng√†y tr∆∞·ªõc`;
                if (diffDays <= 30) return `${Math.ceil(diffDays / 7)} tu·∫ßn tr∆∞·ªõc`;
                
                return date.toLocaleDateString('vi-VN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                console.error('Error formatting date:', error);
                return 'Kh√¥ng r√µ';
            }
        }

        // Debounce utility function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ====================================================================
        // üöÄ INITIALIZATION & EVENT LISTENERS (ENHANCED)
        // ====================================================================

        // Initialize the blog with comprehensive error handling
        async function initializePosts() {
            console.log('üöÄ Initializing Anaro Coffee Blog...');
            showLoading();
            
            try {
                // Clear previous data
                allPosts = [];
                filteredPosts = [];
                extractedShopeeProducts = [];
                filterCache.clear();
                
                if (AUTO_SCAN) {
                    console.log('üîç Auto-scanning posts folder...');
                    allPosts = await scanPostsFolder();
                } else {
                    console.log('üìã Loading manual posts list...');
                    allPosts = await loadManualPosts();
                }
                
                // Ensure allPosts is an array
                if (!Array.isArray(allPosts)) {
                    allPosts = [];
                }
                
                filteredPosts = [...allPosts];
                console.log(`‚úÖ Loaded ${allPosts.length} posts total`);
                
                // Process Shopee products from all posts
                processShopeeProducts(allPosts);
                
            } catch (error) {
                console.error('‚ùå Failed to initialize blog:', error);
                allPosts = [];
                filteredPosts = [];
                extractedShopeeProducts = [];
            } finally {
                hideLoading();
                generateFilterOptions();
                renderFeaturedPost();
                renderPosts();
                renderShopeeProducts();
                updateStats();
                
                console.log('üéâ Blog initialization completed!');
            }
        }

        // Setup all event listeners with enhanced error handling
        function setupEventListeners() {
            try {
                // Search functionality with debouncing
                const debouncedSearch = debounce(() => {
                    try {
                        const query = DOM.searchInput?.value || '';
                        handleSearch(query);
                    } catch (error) {
                        console.error('Error in search handler:', error);
                    }
                }, 300);
                
                const debouncedMobileSearch = debounce(() => {
                    try {
                        const query = DOM.mobileSearchInput?.value || '';
                        handleSearch(query);
                    } catch (error) {
                        console.error('Error in mobile search handler:', error);
                    }
                }, 300);

                if (DOM.searchInput) {
                    DOM.searchInput.addEventListener('input', debouncedSearch);
                }
                
                if (DOM.mobileSearchInput) {
                    DOM.mobileSearchInput.addEventListener('input', debouncedMobileSearch);
                }

                // Filter dropdown functionality
                if (DOM.filterDropdown) {
                    DOM.filterDropdown.addEventListener('click', (e) => {
                        try {
                            e.preventDefault();
                            DOM.filterDropdown.classList.toggle('active');
                            if (DOM.filterOptions) {
                                DOM.filterOptions.classList.toggle('show');
                            }
                        } catch (error) {
                            console.error('Error in filter dropdown:', error);
                        }
                    });
                }

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    try {
                        if (!e.target.closest('.filter-container')) {
                            if (DOM.filterDropdown) DOM.filterDropdown.classList.remove('active');
                            if (DOM.filterOptions) DOM.filterOptions.classList.remove('show');
                        }
                    } catch (error) {
                        console.error('Error in outside click handler:', error);
                    }
                });

                // Refresh functionality
                if (DOM.refreshBtn) {
                    DOM.refreshBtn.addEventListener('click', () => {
                        try {
                            console.log('üîÑ Refreshing posts...');
                            initializePosts();
                        } catch (error) {
                            console.error('Error in refresh:', error);
                        }
                    });
                }
                
                if (DOM.mobileRefreshBtn) {
                    DOM.mobileRefreshBtn.addEventListener('click', () => {
                        try {
                            console.log('üîÑ Refreshing posts (mobile)...');
                            initializePosts();
                        } catch (error) {
                            console.error('Error in mobile refresh:', error);
                        }
                    });
                }

                // Pagination
                if (DOM.prevBtn) {
                    DOM.prevBtn.addEventListener('click', goToPrevPage);
                }
                if (DOM.nextBtn) {
                    DOM.nextBtn.addEventListener('click', goToNextPage);
                }

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    try {
                        if (e.ctrlKey || e.metaKey) {
                            if (e.key === 'k') {
                                e.preventDefault();
                                if (DOM.searchInput) DOM.searchInput.focus();
                            } else if (e.key === 'r') {
                                e.preventDefault();
                                initializePosts();
                            }
                        }
                    } catch (error) {
                        console.error('Error in keyboard shortcut:', error);
                    }
                });

                console.log('üì± Event listeners initialized');
                
            } catch (error) {
                console.error('‚ùå Error setting up event listeners:', error);
            }
        }

        // ====================================================================
        // üé¨ MAIN EXECUTION
        // ====================================================================

        // Auto-initialize Shopee widget when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initShopeeWidget);
        } else {
            initShopeeWidget();
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded');
            try {
                setupEventListeners();
                initializePosts();
            } catch (error) {
                console.error('‚ùå Error in DOMContentLoaded:', error);
            }
        });

        // Handle errors globally
        window.addEventListener('error', (e) => {
            console.error('üí• Global error:', e.error);
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('üí• Unhandled promise rejection:', e.reason);
        });

        // Make ShopeeWidget available globally
        const ShopeeWidget = {
            render: renderShopeeProducts,
            extract: extractShopeeProducts,
            process: processShopeeProducts,
            init: initShopeeWidget,
            config: SHOPEE_CONFIG
        };

        if (typeof window !== 'undefined') {
            window.ShopeeWidget = ShopeeWidget;
        }

        console.log('‚òï Anaro Coffee Blog with Shopee Widget loaded successfully!');
    </script>
</body>
</html>
