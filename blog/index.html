<html lang="vi"><head>
    <!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-P3RFV6Q9QV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-P3RFV6Q9QV');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anaro Coffee Collection Blog</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f1eb 0%, #ede7df 100%);
            color: #4a3c2a;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Mobile Search Header */
        .mobile-header {
            display: none;
            position: sticky;
            top: 0;
            z-index: 200;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e0d0c0;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .mobile-header-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mobile-logo {
            color: #7a5c3f;
            font-size: 1.2em;
            font-weight: 600;
            white-space: nowrap;
        }

        .mobile-search-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0d0c0;
            border-radius: 20px;
            background: #faf8f5;
            color: #4a3c2a;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .mobile-search-input:focus {
            outline: none;
            border-color: #7a5c3f;
            background: white;
            box-shadow: 0 0 0 3px rgba(122, 92, 63, 0.1);
        }

        .mobile-refresh-btn {
            background: linear-gradient(135deg, #8b6b47 0%, #7a5c3f 100%);
            color: white;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 40px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e0d0c0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: #7a5c3f;
            font-size: 1.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-container {
            position: relative;
            max-width: 400px;
            flex: 1;
            margin: 0 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0d0c0;
            border-radius: 25px;
            background: #faf8f5;
            color: #4a3c2a;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #7a5c3f;
            background: white;
            box-shadow: 0 0 0 3px rgba(122, 92, 63, 0.1);
        }

        .search-input::placeholder {
            color: #8b6b47;
        }

        .refresh-btn, .shopee-refresh-btn {
            background: linear-gradient(135deg, #8b6b47 0%, #7a5c3f 100%);
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2em;
        }

        .refresh-btn:hover, .shopee-refresh-btn:hover {
            background: linear-gradient(135deg, #7a5c3f 0%, #6b4d35 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(122, 92, 63, 0.3);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .main-content {
            min-width: 0;
        }

        .page-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title h1 {
            color: #7a5c3f;
            font-size: 2.5em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .page-title p {
            color: #6b5b4d;
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Featured Post Spotlight */
        .featured-section {
            margin-bottom: 40px;
        }

        .featured-label {
            background: linear-gradient(135deg, #7a5c3f 0%, #8b6b47 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(122, 92, 63, 0.3);
        }

        .featured-post {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid #f0ece6;
            transition: all 0.3s ease;
            position: relative;
        }

        .featured-post:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .featured-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: #7a5c3f;
            position: relative;
            overflow: hidden;
        }

        .featured-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .featured-content {
            padding: 30px;
        }

        .featured-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .featured-date {
            color: #8b6b47;
            font-weight: 500;
        }

        .featured-reading-time {
            color: #8b6b47;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .featured-title {
            color: #4a3c2a;
            font-weight: 700;
            font-size: 1.8em;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .featured-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .featured-title a:hover {
            color: #7a5c3f;
        }

        .featured-excerpt {
            color: #6b5b4d;
            font-size: 1.1em;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .featured-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .featured-tag {
            background: linear-gradient(135deg, #7a5c3f 0%, #8b6b47 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 500;
            text-transform: capitalize;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .featured-tag:hover {
            background: linear-gradient(135deg, #6b4d35 0%, #7a5c3f 100%);
            transform: translateY(-2px);
        }

        /* Filter Navigation with Dropdown */
        .filter-nav {
            margin-bottom: 40px;
            text-align: center;
        }

        .filter-nav h3 {
            color: #7a5c3f;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-container {
            position: relative;
            display: inline-block;
            min-width: 300px;
        }

        .filter-dropdown {
            background: white;
            border: 2px solid #e0d0c0;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            color: #4a3c2a;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .filter-dropdown:hover {
            border-color: #7a5c3f;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(122, 92, 63, 0.2);
        }

        .filter-dropdown.active {
            border-color: #7a5c3f;
            background: #f8f5f0;
        }

        .dropdown-arrow {
            color: #7a5c3f;
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .filter-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .filter-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #7a5c3f;
            border-top: none;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .filter-options.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filter-option {
            padding: 12px 20px;
            cursor: pointer;
            color: #4a3c2a;
            font-weight: 500;
            text-transform: capitalize;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .filter-option:last-child {
            border-bottom: none;
        }

        .filter-option:hover {
            background: #f8f5f0;
            color: #7a5c3f;
            transform: translateX(5px);
        }

        .filter-option.selected {
            background: #7a5c3f;
            color: white;
        }

        .filter-option.selected:hover {
            background: #6b4d35;
        }

        /* Shopee Products Widget - Enhanced with Mobile Carousel */
        .shopee-widget {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid #e0d0c0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .shopee-widget h3 {
            color: #7a5c3f;
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .shopee-products {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        /* Mobile Carousel Styles */
        .shopee-products.mobile-carousel {
            display: block;
            position: relative;
        }

        .mobile-carousel-container {
            display: flex;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .mobile-carousel-container .shopee-product {
            min-width: 100%;
            flex-shrink: 0;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .carousel-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e0d0c0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .carousel-dot.active {
            background: #7a5c3f;
            transform: scale(1.2);
        }

        .carousel-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .carousel-nav-btn {
            background: linear-gradient(135deg, #8b6b47 0%, #7a5c3f 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .carousel-nav-btn:hover {
            background: linear-gradient(135deg, #7a5c3f 0%, #6b4d35 100%);
            transform: translateY(-2px);
        }

        .shopee-refresh-btn {
            margin-bottom: 20px;
            font-size: 1em;
            padding: 10px 20px;
        }

        .shopee-product {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #f0ece6;
            transition: all 0.3s ease;
            position: relative;
            text-decoration: none;
            color: inherit;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .shopee-product:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-color: #ff6b35;
        }

        .shopee-product-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: #7a5c3f;
            overflow: hidden;
            position: relative;
        }

        .shopee-product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .shopee-product:hover .shopee-product-image img {
            transform: scale(1.15);
        }

        .shopee-product-info {
            padding: 20px;
        }

        .shopee-product-name {
            font-size: 1em;
            font-weight: 600;
            color: #4a3c2a;
            margin-bottom: 10px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.6em;
        }

        .shopee-product-price {
            color: #e74c3c;
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .shopee-product-old-price {
            color: #999;
            font-size: 0.9em;
            text-decoration: line-through;
            margin-left: 8px;
        }

        .shopee-cta-button {
            background: linear-gradient(135deg, #ff6b35 0%, #e74c3c 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .shopee-cta-button:hover {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .shopee-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff6b35, #f39c12);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .shopee-discount {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 700;
        }

        /* Posts Grid */
        .posts-section h2 {
            color: #7a5c3f;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .post-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0ece6;
            transition: all 0.3s ease;
            position: relative;
        }

        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }

        .post-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: #7a5c3f;
            position: relative;
            overflow: hidden;
        }

        .post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-image.emoji {
            background: linear-gradient(135deg, #f8f5f0 0%, #e0d0c0 100%);
        }

        .post-content {
            padding: 20px;
        }

        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .post-date {
            color: #8b6b47;
            font-size: 0.9em;
            font-weight: 500;
        }

        .post-reading-time {
            color: #8b6b47;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-title {
            color: #4a3c2a;
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .post-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .post-title a:hover {
            color: #7a5c3f;
        }

        .post-excerpt {
            color: #6b5b4d;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .post-tag {
            background: linear-gradient(135deg, #7a5c3f 0%, #8b6b47 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 500;
            text-transform: capitalize;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .post-tag:hover {
            background: linear-gradient(135deg, #6b4d35 0%, #7a5c3f 100%);
            transform: translateY(-1px);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 40px 0;
        }

        .pagination-btn {
            background: white;
            color: #7a5c3f;
            border: 2px solid #e0d0c0;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 45px;
            text-align: center;
            user-select: none;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #7a5c3f;
            color: white;
            border-color: #7a5c3f;
            transform: translateY(-1px);
        }

        .pagination-btn.active {
            background: #7a5c3f;
            color: white;
            border-color: #7a5c3f;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .pagination-info {
            color: #8b6b47;
            font-weight: 500;
            margin: 0 10px;
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #8b6b47;
        }

        .no-results-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .no-results h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #7a5c3f;
        }

        .no-results p {
            font-size: 1.1em;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Stats */
        .stats {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #e0d0c0;
        }

        .stats-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #7a5c3f;
            font-weight: 600;
        }

        .stat-number {
            font-size: 1.2em;
            color: #4a3c2a;
        }

        /* Footer */
        .footer {
            background: rgba(255, 255, 255, 0.9);
            border-top: 1px solid #e0d0c0;
            padding: 40px 20px;
            text-align: center;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            color: #8b6b47;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #7a5c3f;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: #4a3c2a;
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e0d0c0;
            border-top: 4px solid #7a5c3f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                display: none;
            }

            .mobile-header {
                display: block;
            }

            .container {
                padding: 20px 15px;
            }

            .filter-container {
                min-width: 250px;
                width: 100%;
                max-width: 400px;
            }
            
            .filter-options {
                max-height: 200px;
            }

            .posts-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .shopee-product-name {
                font-size: 1.1em;
            }

            .shopee-product-price {
                font-size: 1.3em;
            }

            .shopee-cta-button {
                padding: 15px 20px;
                font-size: 1em;
            }

            .featured-image {
                height: 220px;
                font-size: 3em;
            }

            .featured-content {
                padding: 20px;
            }

            .featured-title {
                font-size: 1.5em;
            }

            .page-title h1 {
                font-size: 2em;
            }

            .stats-content {
                gap: 15px;
            }

            .footer-links {
                flex-direction: column;
                gap: 15px;
            }

            .pagination {
                gap: 10px;
            }

            .pagination-btn {
                padding: 8px 12px;
                min-width: 40px;
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px 10px;
            }

            .featured-content {
                padding: 15px;
            }

            .post-content {
                padding: 15px;
            }

            .mobile-header-content {
                gap: 10px;
            }

            .mobile-logo {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">‚òï Anaro</div>
            <input type="text" class="mobile-search-input" id="mobileSearchInput" placeholder="T√¨m ki·∫øm...">
            <button class="mobile-refresh-btn" id="mobileRefreshBtn" title="T·∫£i l·∫°i">üîÑ</button>
        </div>
    </div>

    <!-- Desktop Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                ‚òï Anaro Coffee Blog
            </div>
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="T√¨m ki·∫øm b√†i vi·∫øt...">
            </div>
            <button class="refresh-btn" id="refreshBtn" title="T·∫£i l·∫°i posts">üîÑ</button>
        </div>
    </header>

    <div class="container">
        <div class="page-title">
            <h1>‚òï Coffee Blog</h1>
            <p>Kh√°m ph√° th·∫ø gi·ªõi c√† ph√™ qua nh·ªØng c√¢u chuy·ªán, ki·∫øn th·ª©c v√† tr·∫£i nghi·ªám th√∫ v·ªã</p>
        </div>

        <div class="stats">
            <div class="stats-content">
                <div class="stat-item">
                    üìö <span class="stat-number" id="totalPosts">0</span> B√†i vi·∫øt
                </div>
                <div class="stat-item">
                    üè∑Ô∏è <span class="stat-number" id="totalTags">0</span> Ch·ªß ƒë·ªÅ
                </div>
                <div class="stat-item">
                    üìÖ C·∫≠p nh·∫≠t <span class="stat-number">H√¥m nay</span>
                </div>
            </div>
        </div>

        <!-- Featured Post Section -->
        <div class="featured-section">
            <div class="featured-label">üåü B√†i Vi·∫øt N·ªïi B·∫≠t</div>
            <div class="featured-post" id="featuredPost">
                    <div class="featured-content">
                        <div class="no-results">
                            <div class="no-results-icon">üîç</div>
                            <h3>Ch∆∞a c√≥ b√†i vi·∫øt n·ªïi b·∫≠t</h3>
                            <p>H√£y th√™m b√†i vi·∫øt ƒë·ªÉ hi·ªÉn th·ªã ·ªü ƒë√¢y</p>
                        </div>
                    </div>
                </div>
        </div>

        <!-- Shopee Products Widget -->
        <div class="shopee-widget" id="shopeeWidget" style="display: block;">
            <h3>üõí S·∫£n Ph·∫©m T·ª´ B√†i Vi·∫øt</h3>
            <div class="shopee-products mobile-carousel" id="shopeeProducts">
                    <button class="shopee-refresh-btn" onclick="nextProduct()">üîÑ S·∫£n ph·∫©m kh√°c</button>
                    <div class="mobile-carousel-container" id="carouselContainer" style="transform: translateX(0%);">
                        
                <div class="shopee-product" onclick="window.open('https://s.shopee.vn/1LWRLK1RkU', '_blank', 'noopener,noreferrer')">
                    
                    <div class="shopee-product-image">
                        <img src="https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=300&amp;h=200&amp;fit=crop" alt="B·ªô T√°ch Cafe G·ªëm S·ª© Cao C·∫•p K√®m ƒêƒ©a" onerror="this.parentElement.innerHTML='‚òï';">
                    </div>
                    <div class="shopee-product-info">
                        <div class="shopee-product-name">B·ªô T√°ch Cafe G·ªëm S·ª© Cao C·∫•p K√®m ƒêƒ©a</div>
                        <div class="shopee-product-price">
                            90.000ƒë
                            
                        </div>
                        <button class="shopee-cta-button" onclick="event.stopPropagation(); window.open('https://s.shopee.vn/1LWRLK1RkU', '_blank', 'noopener,noreferrer')">
                            üõí Mua ngay
                        </button>
                    </div>
                    <div class="shopee-badge">Cao c·∫•p</div>
                </div>
            
                <div class="shopee-product" onclick="window.open('https://s.shopee.vn/1VprXd0oPX', '_blank', 'noopener,noreferrer')">
                    
                    <div class="shopee-product-image">
                        <img src="https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=300&amp;h=200&amp;fit=crop" alt="·∫§m R√≥t N∆∞·ªõc C·ªï Ng·ªóng Chuy√™n Nghi·ªáp" onerror="this.parentElement.innerHTML='‚òï';">
                    </div>
                    <div class="shopee-product-info">
                        <div class="shopee-product-name">·∫§m R√≥t N∆∞·ªõc C·ªï Ng·ªóng Chuy√™n Nghi·ªáp</div>
                        <div class="shopee-product-price">
                            189.000ƒë
                            
                        </div>
                        <button class="shopee-cta-button" onclick="event.stopPropagation(); window.open('https://s.shopee.vn/1VprXd0oPX', '_blank', 'noopener,noreferrer')">
                            üõí Mua ngay
                        </button>
                    </div>
                    <div class="shopee-badge">Best seller</div>
                </div>
            
                <div class="shopee-product" onclick="window.open('https://s.shopee.vn/10tawi2iQS', '_blank', 'noopener,noreferrer')">
                    
                    <div class="shopee-product-image">‚òï</div>
                    <div class="shopee-product-info">
                        <div class="shopee-product-name">B√¨nh Pha C√† Ph√™ Nh·ªè Gi·ªçt Cold Brew</div>
                        <div class="shopee-product-price">
                            669.000ƒë
                            
                        </div>
                        <button class="shopee-cta-button" onclick="event.stopPropagation(); window.open('https://s.shopee.vn/10tawi2iQS', '_blank', 'noopener,noreferrer')">
                            üõí Mua ngay
                        </button>
                    </div>
                    <div class="shopee-badge">Premium</div>
                </div>
            
                    </div>
                    <div class="carousel-indicators" id="carouselIndicators">
                        <div class="carousel-dot active" onclick="goToProduct(0)"></div><div class="carousel-dot " onclick="goToProduct(1)"></div><div class="carousel-dot " onclick="goToProduct(2)"></div>
                    </div>
                    <div class="carousel-navigation">
                        <button class="carousel-nav-btn" onclick="prevProduct()">‚Äπ</button>
                        <button class="carousel-nav-btn" onclick="nextProduct()">‚Ä∫</button>
                    </div>
                </div>
        </div>

        <!-- Filter Navigation with Dropdown -->
        <div class="filter-nav">
            <h3>üéØ L·ªçc theo ch·ªß ƒë·ªÅ</h3>
            <div class="filter-container">
                <div class="filter-dropdown" id="filterDropdown">
                    <span id="selectedFilter">T·∫•t c·∫£</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </div>
                <div class="filter-options" id="filterOptions"><div class="filter-option selected" data-tag="all">T·∫•t c·∫£</div></div>
            </div>
        </div>

        <div class="main-content">
            <!-- Other Posts Section -->
            <div class="posts-section">
                <h2>üìö C√°c B√†i Vi·∫øt Kh√°c</h2>
                
                <div class="loading" id="loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px; color: #8b6b47;">ƒêang t·∫£i b√†i vi·∫øt...</p>
                </div>

                <div class="posts-grid" id="postsGrid" style="display: none;">
                    <!-- Posts will be inserted here -->
                </div>

                <div class="no-results" id="noResults" style="display: block;">
                    <div class="no-results-icon">üîç</div>
                    <h3>Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt</h3>
                    <p>Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c ho·∫∑c ch·ªçn ch·ªß ƒë·ªÅ kh√°c</p>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination" style="display: none;">
                    <button class="pagination-btn" id="prevBtn" disabled="">‚Äπ Tr∆∞·ªõc</button>
                    <div class="pagination-info" id="paginationInfo"></div>
                    <button class="pagination-btn" id="nextBtn">Sau ‚Ä∫</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#about">V·ªÅ ch√∫ng t√¥i</a>
                <a href="#contact">Li√™n h·ªá</a>
                <a href="#rss">RSS</a>
                <a href="#github">GitHub</a>
            </div>
            <p>¬© 2024 Anaro Coffee Collection. Made with ‚òï and ‚ù§Ô∏è</p>
        </div>
    </footer>

    <script>
        // ====================================================================
        // üì± CONFIGURATION & GLOBALS (IMPROVED)
        // ====================================================================
        
        const POSTS_FOLDER = './posts/';
        const AUTO_SCAN = false;
        const POSTS_PER_PAGE = 5;
        
        // FIXED: Updated manual posts list with correct filenames
        const manualPosts = [
            'caffein-cold-brew-ca-phe.html',
            'cach-chon-hat-ca-phe-danh-cho-pha-may.html',
            'cac-muc-rang-ca-phe.html',
            'cach-bao-quan-ca-phe.html',
            'arabica-robusta-blog.html',
            'cach-pha-ca-phe-phin.html',
            'bai-viet-dau-tien.html'
        ];

        // Shopee configuration
        const SHOPEE_CONFIG = {
            maxProductsPerPost: 6,
            desktopProductsCount: 3,
            mobileProductsCount: 1
        };

        // Global state
        let allPosts = [];
        let filteredPosts = [];
        let currentFilter = 'all';
        let currentPage = 1;
        let totalPages = 1;
        let filterCache = new Map();
        let currentProductIndex = 0;
        let isMobile = false;
        let extractedShopeeProducts = [];

        // Cached DOM elements
        const DOM = {
            featuredPost: document.getElementById('featuredPost'),
            postsGrid: document.getElementById('postsGrid'),
            searchInput: document.getElementById('searchInput'),
            mobileSearchInput: document.getElementById('mobileSearchInput'),
            filterDropdown: document.getElementById('filterDropdown'),
            filterOptions: document.getElementById('filterOptions'),
            selectedFilter: document.getElementById('selectedFilter'),
            shopeeProducts: document.getElementById('shopeeProducts'),
            shopeeWidget: document.getElementById('shopeeWidget'),
            noResults: document.getElementById('noResults'),
            totalPostsEl: document.getElementById('totalPosts'),
            totalTagsEl: document.getElementById('totalTags'),
            loading: document.getElementById('loading'),
            refreshBtn: document.getElementById('refreshBtn'),
            mobileRefreshBtn: document.getElementById('mobileRefreshBtn'),
            pagination: document.getElementById('pagination'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            paginationInfo: document.getElementById('paginationInfo')
        };

        // ====================================================================
        // üîí SECURITY UTILITIES (IMPROVED)
        // ====================================================================

        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function isValidImageUrl(url) {
            if (!url || typeof url !== 'string') return false;
            
            // FIXED: Clean URL first - remove whitespace and line breaks
            url = url.trim().replace(/\s+/g, '');
            
            try {
                const urlObj = new URL(url);
                const isValidProtocol = urlObj.protocol === 'https:' || urlObj.protocol === 'http:';
                const hasValidHost = urlObj.hostname && !urlObj.hostname.includes('javascript');
                const notDataOrJs = !url.toLowerCase().startsWith('javascript:') && !url.toLowerCase().startsWith('data:text/html');
                
                // IMPROVED: More flexible image detection
                const hasImageExtension = /\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|tiff)(\?.*)?$/i.test(url);
                const isImageDomain = /unsplash\.com|pixabay\.com|pexels\.com|cloudinary\.com|amazonaws\.com|anarocafe.*\.vercel\.app/.test(urlObj.hostname);
                const hasImagesPath = /\/images?\//i.test(url);
                const isImageUrl = hasImageExtension || isImageDomain || hasImagesPath;
                
                return isValidProtocol && hasValidHost && notDataOrJs && isImageUrl;
            } catch (e) {
                console.warn('Invalid image URL:', url, e);
                return false;
            }
        }

        function isValidShopeeUrl(url) {
            if (!url || typeof url !== 'string') return false;
            
            try {
                const urlObj = new URL(url);
                const validDomains = ['shopee.vn', 'shp.ee', 's.shopee.vn'];
                return validDomains.some(domain => urlObj.hostname === domain || urlObj.hostname.endsWith('.' + domain));
            } catch (e) {
                return false;
            }
        }

        function sanitizeUrl(url) {
            if (!url || typeof url !== 'string') return '';
            
            try {
                const urlObj = new URL(url);
                if (urlObj.protocol === 'https:' || urlObj.protocol === 'http:') {
                    return url;
                }
            } catch (e) {
                // Invalid URL
            }
            return '';
        }

        // ====================================================================
        // üõçÔ∏è SHOPEE EXTRACTION (IMPROVED & MORE PRECISE)
        // ====================================================================

        function extractShopeeProducts(html, postTitle) {
            const products = [];
            
            if (!html || !postTitle) return products;
            
            // FIXED: More precise patterns to avoid false positives
            const shopeeLinkPatterns = [
                // Only capture actual Shopee domains
                /https:\/\/(?:www\.)?shopee\.vn\/[a-zA-Z0-9\-._~:/?#[\]@!            .shopee-product'()*+,;=%]+/gi,
                /https:\/\/shp\.ee\/[a-zA-Z0-9]+/gi,
                /https:\/\/s\.shopee\.vn\/[a-zA-Z0-9]+/gi
            ];
            
            const foundLinks = new Set();
            
            // Extract Shopee links with validation
            for (const pattern of shopeeLinkPatterns) {
                let match;
                while ((match = pattern.exec(html)) !== null) {
                    const link = match[0];
                    if (isValidShopeeUrl(link) && !foundLinks.has(link)) {
                        foundLinks.add(link);
                        console.log(`üõí Found Shopee link: ${link}`);
                    }
                }
            }
            
            // FIXED: Extract product images more precisely
            const productImages = extractProductImagesFromPost(html);
            
            if (foundLinks.size === 0) {
                console.log('‚ùå No Shopee links found in post');
                return [];
            }
            
            Array.from(foundLinks).forEach((link, index) => {
                const productName = extractProductNameFromContext(html, link, postTitle);
                const price = extractPriceFromContext(html, link);
                
                products.push({
                    name: escapeHtml(productName),
                    price: escapeHtml(price || "Xem gi√° tr√™n Shopee"),
                    url: link,
                    image: productImages[index % productImages.length] || null,
                    badge: "T·ª´ b√†i vi·∫øt",
                    postTitle: escapeHtml(postTitle)
                });
            });
            
            console.log(`‚úÖ Extracted ${products.length} Shopee products from: ${postTitle}`);
            return products.slice(0, SHOPEE_CONFIG.maxProductsPerPost);
        }

        function extractProductImagesFromPost(html) {
            const images = [];
            
            if (!html) return images;
            
            // IMPROVED: Clean HTML and handle line breaks in URLs
            const cleanHtml = html.replace(/\n\s*/g, ' ');
            
            // More comprehensive image extraction patterns
            const imagePatterns = [
                // Standard img tags with better whitespace handling
                /<img[^>]*src=["']([^"'\s]+(?:\s*\n\s*[^"'\s]*)*?)["'][^>]*>/gi,
                // Open Graph images
                /<meta\s+property=["']og:image["']\s+content=["']([^"']+)["'][^>]*>/gi,
                // Twitter card images
                /<meta\s+name=["']twitter:image["']\s+content=["']([^"']+)["'][^>]*>/gi,
                // Schema.org images
                /<meta\s+itemprop=["']image["']\s+content=["']([^"']+)["'][^>]*>/gi
            ];
            
            for (const pattern of imagePatterns) {
                let match;
                while ((match = pattern.exec(cleanHtml)) !== null) {
                    let imageUrl = match[1];
                    if (imageUrl) {
                        // FIXED: Clean URL properly - remove line breaks and extra whitespace
                        imageUrl = imageUrl.trim().replace(/\s+/g, '');
                        
                        console.log(`üñºÔ∏è Found image URL: "${imageUrl}"`);
                        
                        if (isValidImageUrl(imageUrl) && !images.includes(imageUrl)) {
                            images.push(imageUrl);
                            console.log(`‚úÖ Valid image added: ${imageUrl}`);
                        } else {
                            console.log(`‚ùå Invalid or duplicate image: ${imageUrl}`);
                        }
                    }
                }
            }
            
            // Fallback: Extract from hero/section image containers
            const heroImageMatches = cleanHtml.match(/<div[^>]*(?:hero-image|section-image)[^>]*>[\s\S]*?<img[^>]*src=["']([^"']+)["'][^>]*>[\s\S]*?<\/div>/gi);
            if (heroImageMatches) {
                heroImageMatches.forEach(match => {
                    const imgMatch = match.match(/src=["']([^"']+)["']/i);
                    if (imgMatch && imgMatch[1]) {
                        let imageUrl = imgMatch[1].trim().replace(/\s+/g, '');
                        if (isValidImageUrl(imageUrl) && !images.includes(imageUrl)) {
                            images.push(imageUrl);
                            console.log(`‚úÖ Hero/section image added: ${imageUrl}`);
                        }
                    }
                });
            }
            
            console.log(`üìä Total images extracted: ${images.length}`);
            
            // Fallback to high-quality coffee images if no images found
            if (images.length === 0) {
                console.log('üîÑ Using fallback images');
                images.push(
                    'https://images.unsplash.com/photo-1461023058943-07fcbe16d735?w=400&h=300&fit=crop&auto=format',
                    'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400&h=300&fit=crop&auto=format',
                    'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=400&h=300&fit=crop&auto=format'
                );
            }
            
            return images;
        }

        function extractProductNameFromContext(html, link, postTitle) {
            try {
                // IMPROVED: Better product name extraction
                const linkIndex = html.indexOf(link);
                if (linkIndex > -1) {
                    // Look for text around the link (300 chars before and after)
                    const contextStart = Math.max(0, linkIndex - 300);
                    const contextEnd = Math.min(html.length, linkIndex + 300);
                    const context = html.substring(contextStart, contextEnd);
                    
                    // Try to find product names in various formats
                    const namePatterns = [
                        // Text inside link tags
                        /<a[^>]*href=["'][^"']*shopee[^"']*["'][^>]*>([^<]{10,60})<\/a>/i,
                        // Text before or after shopee links
                        /(?:s·∫£n ph·∫©m|product)[\s:]*([^<\n]{10,60})[\s\S]*?shopee/i,
                        // Headers or strong text near links
                        /<h[1-6][^>]*>([^<]{10,60})<\/h[1-6]>[\s\S]{0,100}shopee/i,
                        /<strong[^>]*>([^<]{10,60})<\/strong>[\s\S]{0,100}shopee/i,
                        // Price context (often indicates product names)
                        /([^<\n]{10,60})[\s-]*\d+[.,]\d+.*shopee/i
                    ];
                    
                    for (const pattern of namePatterns) {
                        const match = context.match(pattern);
                        if (match && match[1] && match[1].trim()) {
                            let name = match[1].trim()
                                .replace(/['"]/g, '')
                                .replace(/\s+/g, ' ')
                                .substring(0, 60);
                            
                            if (name.length > 15) { // Ensure meaningful name
                                return name;
                            }
                        }
                    }
                }
                
                // Fallback: Generate from URL
                const urlObj = new URL(link);
                const pathParts = urlObj.pathname.split('/');
                for (const part of pathParts) {
                    if (part.length > 10 && part.includes('-')) {
                        const decoded = decodeURIComponent(part)
                                       .replace(/-/g, ' ')
                                       .replace(/\b\w/g, l => l.toUpperCase())
                                       .substring(0, 50);
                        if (decoded && decoded.trim()) {
                            return decoded.trim();
                        }
                    }
                }
            } catch (e) {
                console.warn('Error extracting product name:', e);
            }
            
            return `${postTitle.substring(0, 30)} - S·∫£n ph·∫©m`;
        }

        function extractPriceFromContext(html, link) {
            if (!html || !link) return null;
            
            const linkIndex = html.indexOf(link);
            if (linkIndex === -1) return null;
            
            // Look for price in surrounding text
            const searchText = html.substring(
                Math.max(0, linkIndex - 500), 
                linkIndex + 500
            );
            
            const pricePatterns = [
                // Vietnamese price formats
                /(\d{1,3}(?:[,.]?\d{3})*)\s*(?:ƒë|dong|vnd|‚Ç´)/gi,
                /(\d{1,3}(?:[,.]?\d{3})*)\s*(?:ngh√¨n|k|thousand)/gi,
                /gi√°\s*:?\s*(\d{1,3}(?:[,.]?\d{3})*)/gi,
                /price\s*:?\s*(\d{1,3}(?:[,.]?\d{3})*)/gi,
                // Look for currency symbols
                /[\$‚Ç´]\s*(\d{1,3}(?:[,.]?\d{3})*)/gi
            ];
            
            for (const pattern of pricePatterns) {
                const match = searchText.match(pattern);
                if (match && match[1]) {
                    const price = match[1];
                    return price.includes('ƒë') || price.includes('‚Ç´') ? price : `${price}ƒë`;
                }
            }
            
            return null;
        }

        // ====================================================================
        // üìñ POST LOADING (IMPROVED & MORE RELIABLE)
        // ====================================================================

        async function loadPostMetadata(filepath, id) {
            try {
                console.log(`üìÑ Loading post: ${filepath}`);
                
                const response = await fetch(filepath, {
                    cache: 'no-cache', // FIXED: Always get latest version
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - ${response.statusText}`);
                }
                
                const html = await response.text();
                const filename = filepath.split('/').pop();
                const metadata = parsePostMetadata(html, filename);
                
                // Extract Shopee products from this post
                const shopeeProducts = extractShopeeProducts(html, metadata.title);
                
                return {
                    id: id,
                    title: escapeHtml(metadata.title),
                    excerpt: escapeHtml(metadata.excerpt),
                    tags: metadata.tags || ['coffee'],
                    date: metadata.date,
                    readTime: escapeHtml(metadata.readTime),
                    image: metadata.image,
                    imageType: metadata.imageType,
                    link: sanitizeUrl(filepath) || filepath,
                    shopeeProducts: shopeeProducts,
                    lastModified: new Date().toISOString() // FIXED: Add timestamp
                };
            } catch (error) {
                console.error(`‚ùå Error loading ${filepath}:`, error);
                return null;
            }
        }

        async function loadManualPosts() {            
            if (!Array.isArray(manualPosts) || manualPosts.length === 0) {
                console.log('üìã No manual posts configured');
                return [];
            }
            
            console.log(`üìö Loading ${manualPosts.length} manual posts...`);
            
            // FIXED: Sort posts by date (newest first)
            const loadPromises = manualPosts.map(async (filename, index) => {
                try {
                    if (!filename || typeof filename !== 'string') {
                        console.warn(`‚ö†Ô∏è Invalid filename at index ${index}:`, filename);
                        return null;
                    }
                    
                    const postData = await loadPostMetadata(POSTS_FOLDER + filename, index + 1);
                    if (postData) {
                        console.log(`‚úÖ Loaded: ${postData.title}`);
                        return postData;
                    }
                    return null;
                } catch (error) {
                    console.error(`‚ùå Failed to load: ${filename}`, error);
                    return null;
                }
            });
            
            const results = await Promise.all(loadPromises);
            const validPosts = results.filter(post => post !== null);
            
            // FIXED: Sort by date (newest first) and filename as fallback
            validPosts.sort((a, b) => {
                // First sort by date
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                if (dateB.getTime() !== dateA.getTime()) {
                    return dateB.getTime() - dateA.getTime();
                }
                // Then by filename to ensure consistency
                return a.link.localeCompare(b.link);
            });
            
            console.log(`üìä Successfully loaded ${validPosts.length}/${manualPosts.length} posts`);
            return validPosts;
        }

        // IMPROVED: Better metadata parsing
        function parsePostMetadata(html, filename) {
            console.log(`üîç Parsing metadata for: ${filename}`);
            const metadata = {};
            
            // Method 1: HTML Comments (enhanced)
            const commentPatterns = [
                /<!--\s*META\s*([\s\S]*?)\s*-->/gi,
                /<!--\s*POST_INFO\s*([\s\S]*?)\s*-->/gi,
                /<!--\s*(title|tags|excerpt|date|readtime):\s*([^\n\r]+)\s*-->/gi,
                /<!--\s*([\s\S]*?)\s*-->/g
            ];
            
            for (const pattern of commentPatterns) {
                let match;
                while ((match = pattern.exec(html)) !== null) {
                    const content = match[1] || match[0];
                    
                    if (pattern.source.includes('title|tags')) {
                        // Direct key-value extraction
                        const key = match[1] ? match[1].toLowerCase() : '';
                        const value = match[2] ? match[2].trim() : '';
                        
                        if (key && value) {
                            if (key === 'tags' && value) {
                                metadata.tags = value.split(',').map(tag => tag.trim().toLowerCase());
                            } else if (key === 'title') {
                                metadata.title = value;
                            } else if (key === 'excerpt') {
                                metadata.excerpt = value;
                            } else if (key === 'date') {
                                metadata.date = value;
                            } else if (key === 'readtime') {
                                metadata.readTime = value;
                            }
                        }
                    } else {
                        // Parse multi-line comments
                        const lines = content.split('\n');
                        for (const line of lines) {
                            const keyValue = line.match(/(\w+):\s*(.+)/);
                            if (keyValue) {
                                const key = keyValue[1].toLowerCase();
                                const value = keyValue[2].trim();
                                
                                if (key === 'tags' && value) {
                                    metadata.tags = value.split(',').map(tag => tag.trim().toLowerCase());
                                } else if (key === 'title') {
                                    metadata.title = value;
                                } else if (key === 'excerpt' || key === 'description') {
                                    metadata.excerpt = value;
                                } else if (key === 'date') {
                                    metadata.date = value;
                                } else if (key === 'readtime' || key === 'reading-time') {
                                    metadata.readTime = value;
                                }
                            }
                        }
                    }
                }
            }
            
            // Method 2: Meta tags (enhanced)
            const metaPatterns = [
                { pattern: /<meta\s+name=["']keywords["']\s+content=["']([^"']+)["']/i, key: 'tags' },
                { pattern: /<meta\s+name=["']description["']\s+content=["']([^"']+)["']/i, key: 'excerpt' },
                { pattern: /<meta\s+property=["']og:title["']\s+content=["']([^"']+)["']/i, key: 'title' },
                { pattern: /<meta\s+property=["']og:description["']\s+content=["']([^"']+)["']/i, key: 'excerpt' },
                { pattern: /<meta\s+name=["']tags["']\s+content=["']([^"']+)["']/i, key: 'tags' }
            ];
            
            for (const { pattern, key } of metaPatterns) {
                const match = html.match(pattern);
                if (match && !metadata[key]) {
                    if (key === 'tags') {
                        metadata.tags = match[1].split(',').map(tag => tag.trim().toLowerCase());
                    } else {
                        metadata[key] = match[1];
                    }
                }
            }
            
            // Extract title from HTML if not found
            if (!metadata.title) {
                const titleMatch = html.match(/<title>([^<]+)<\/title>/i) || 
                                  html.match(/<h1[^>]*>([^<]+)<\/h1>/i);
                if (titleMatch) {
                    metadata.title = titleMatch[1].trim();
                }
            }
            
            // Extract excerpt from first meaningful paragraph
            if (!metadata.excerpt) {
                const paragraphMatches = html.match(/<p[^>]*>([^<]+)<\/p>/gi);
                if (paragraphMatches) {
                    for (const p of paragraphMatches) {
                        const content = p.replace(/<[^>]*>/g, '').trim();
                        if (content.length > 50) {
                            metadata.excerpt = content.substring(0, 150) + '...';
                            break;
                        }
                    }
                }
            }
            
            // Enhanced content analysis for tags
            if (!metadata.tags || metadata.tags.length === 0) {
                metadata.tags = analyzeContentForTags(html, filename);
            }
            
            // Extract first image
            const firstImage = extractFirstImage(html);
            if (firstImage) {
                metadata.image = firstImage;
                metadata.imageType = 'image';
            }
            
            // Set defaults with better fallbacks
            metadata.title = metadata.title || formatFilenameToTitle(filename);
            metadata.excerpt = metadata.excerpt || 'ƒê·ªçc b√†i vi·∫øt ƒë·ªÉ kh√°m ph√° th√™m...';
            metadata.tags = metadata.tags && metadata.tags.length > 0 ? metadata.tags : ['coffee'];
            metadata.date = metadata.date || getDefaultDateFromFilename(filename);
            metadata.readTime = metadata.readTime || calculateReadingTime(html);
            
            if (!metadata.image) {
                metadata.image = getEmojiForTags(metadata.tags);
                metadata.imageType = 'emoji';
            }
            
            console.log(`‚úÖ Final metadata for ${filename}:`, metadata);
            return metadata;
        }

        // Helper functions for metadata parsing
        function formatFilenameToTitle(filename) {
            return filename
                .replace('.html', '')
                .replace(/[-_]/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase())
                .trim();
        }

        function getDefaultDateFromFilename(filename) {
            // Try to extract date from filename patterns
            const dateMatch = filename.match(/(\d{4})-?(\d{2})-?(\d{2})/);
            if (dateMatch) {
                return `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`;
            }
            return new Date().toISOString().split('T')[0];
        }

        function calculateReadingTime(html) {
            if (!html) return '5 ph√∫t ƒë·ªçc';
            
            const textContent = html.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
            const wordCount = textContent.split(' ').length;
            const readingTime = Math.ceil(wordCount / 200); // 200 words per minute average
            
            return `${readingTime} ph√∫t ƒë·ªçc`;
        }

        function analyzeContentForTags(html, filename) {
            const tags = [];
            
            if (!html || !filename) return ['coffee'];
            
            const content = html.toLowerCase();
            
            // Vietnamese coffee terms mapping
            const termMap = {
                'brewing': ['pha ch·∫ø', 'pha c√† ph√™', 'c√°ch pha', 'brewing', 'drip', 'pour over'],
                'equipment': ['m√°y pha', 'phin', 'espresso machine', 'grinder', 'd·ª•ng c·ª•', 'thi·∫øt b·ªã'],
                'origin': ['ngu·ªìn g·ªëc', 'xu·∫•t x·ª©', 'v√πng tr·ªìng', 'origin', 'farm', 'plantation'],
                'vietnamese': ['vi·ªát nam', 'vietnamese', 'vn coffee', 'c√† ph√™ vi·ªát'],
                'arabica': ['arabica'],
                'robusta': ['robusta'],
                'specialty': ['specialty', 'ƒë·∫∑c bi·ªát', 'cao c·∫•p', 'premium'],
                'culture': ['vƒÉn h√≥a', 'culture', 'truy·ªÅn th·ªëng', 'tradition'],
                'health': ['s·ª©c kh·ªèe', 'health', 'l·ª£i √≠ch', 'benefit', 'caffein'],
                'review': ['ƒë√°nh gi√°', 'review', 'tasting', 'th·ª≠'],
                'tips': ['m·∫πo', 'tips', 'b√≠ quy·∫øt', 'h∆∞·ªõng d·∫´n', 'c√°ch'],
                'cold': ['cold brew', 'c√† ph√™ l·∫°nh', 'iced coffee', 'l·∫°nh'],
                'latte': ['latte', 's·ªØa'],
                'espresso': ['espresso'],
                'phin': ['phin'],
                'b·∫£o qu·∫£n c√† ph√™': ['b·∫£o qu·∫£n', 'l∆∞u tr·ªØ', 'storage'],
                'rang c√† ph√™': ['rang', 'roast', 'roasting'],
                'light roast': ['rang nh·∫π', 'light roast'],
                'medium roast': ['rang v·ª´a', 'medium roast'],
                'dark roast': ['rang ƒë·∫≠m', 'dark roast']
            };
            
            // Analyze filename first
            const filenameLower = filename.toLowerCase();
            Object.entries(termMap).forEach(([tag, terms]) => {
                if (terms.some(term => filenameLower.includes(term))) {
                    tags.push(tag);
                }
            });
            
            // Analyze content
            Object.entries(termMap).forEach(([tag, terms]) => {
                const score = terms.reduce((acc, term) => {
                    const matches = (content.match(new RegExp(term, 'g')) || []).length;
                    return acc + matches;
                }, 0);
                
                if (score >= 2 || (score >= 1 && terms.some(term => filenameLower.includes(term)))) {
                    if (!tags.includes(tag)) {
                        tags.push(tag);
                    }
                }
            });
            
            // Always include 'coffee' as base tag if no other tags found
            if (tags.length === 0) {
                tags.push('coffee');
            }
            
            return tags;
        }

        function extractFirstImage(html) {
            if (!html) return null;
            
            // FIXED: Clean HTML to handle line breaks in URLs
            const cleanHtml = html.replace(/\n\s*/g, ' ');
            
            const patterns = [
                // Open Graph image (highest priority)
                /<meta\s+property=["']og:image["']\s+content=["']([^"']+)["'][^>]*>/i,
                // Twitter card image  
                /<meta\s+name=["']twitter:image["']\s+content=["']([^"']+)["'][^>]*>/i,
                // Hero/featured images with better whitespace handling
                /<img[^>]*class=["'][^"']*(?:hero|featured|main)[^"']*["'][^>]*src=["']([^"']+)["'][^>]*>/i,
                // First img tag in content with better URL extraction
                /<img[^>]*src=["']([^"'\s]+(?:\s*\n\s*[^"'\s]*)*?)["'][^>]*>/i,
                // Background images
                /background(?:-image)?\s*:\s*url\(['"]?([^'"]+?)['"]?\)/i
            ];

            for (const pattern of patterns) {
                const match = cleanHtml.match(pattern);
                if (match) {
                    let imageUrl = match[1];
                    if (imageUrl) {
                        // CRITICAL FIX: Clean the URL properly
                        imageUrl = imageUrl.trim().replace(/\s+/g, '');
                        console.log(`üéØ Potential first image: "${imageUrl}"`);
                        
                        if (isValidImageUrl(imageUrl)) {
                            console.log(`‚úÖ Valid first image found: ${imageUrl}`);
                            return imageUrl;
                        } else {
                            console.log(`‚ùå Invalid first image: ${imageUrl}`);
                        }
                    }
                }
            }
            
            console.log('‚ùå No valid first image found');
            return null;
        }

        function getEmojiForTags(tags) {
            if (!Array.isArray(tags)) return 'üìÑ';
            
            const emojiMap = {
                'brewing': '‚òï',
                'tips': 'üí°', 
                'culture': 'üèõÔ∏è',
                'origin': 'üå±',
                'review': '‚≠ê',
                'equipment': '‚öôÔ∏è',
                'coffee': '‚òï',
                'latte': 'ü•õ',
                'espresso': 'üáÆüáπ',
                'cold': 'üßä',
                'health': 'üí™',
                'specialty': '‚≠ê',
                'vietnamese': 'üáªüá≥',
                'arabica': 'üåø',
                'robusta': 'üí™',
                'phin': '‚òï',
                'b·∫£o qu·∫£n c√† ph√™': 'üì¶',
                'rang c√† ph√™': 'üî•',
                'light roast': 'üåÖ',
                'medium roast': '‚òÄÔ∏è',
                'dark roast': 'üåö'
            };
            
            for (const tag of tags) {
                if (tag && emojiMap[tag.toLowerCase()]) {
                    return emojiMap[tag.toLowerCase()];
                }
            }
            
            return 'üìÑ';
        }

        // ====================================================================
        // üé® RENDERING FUNCTIONS (IMPROVED)
        // ====================================================================

        function renderFeaturedPost() {
            if (!DOM.featuredPost) return;
            
            if (!Array.isArray(filteredPosts) || filteredPosts.length === 0) {
                DOM.featuredPost.innerHTML = `
                    <div class="featured-content">
                        <div class="no-results">
                            <div class="no-results-icon">üîç</div>
                            <h3>Ch∆∞a c√≥ b√†i vi·∫øt n·ªïi b·∫≠t</h3>
                            <p>H√£y th√™m b√†i vi·∫øt ƒë·ªÉ hi·ªÉn th·ªã ·ªü ƒë√¢y</p>
                        </div>
                    </div>
                `;
                return;
            }

            const post = filteredPosts[0];
            if (!post) return;

            const imageContent = post.imageType === 'image' && isValidImageUrl(post.image) ? 
                `<img src="${escapeHtml(post.image)}" alt="${escapeHtml(post.title)}" onerror="this.parentElement.innerHTML='${getEmojiForTags(post.tags)}'; this.parentElement.classList.add('emoji');">` : 
                escapeHtml(post.image || 'üìÑ');

            DOM.featuredPost.innerHTML = `
                <div class="featured-image ${post.imageType === 'emoji' ? 'emoji' : ''}">
                    ${imageContent}
                </div>
                <div class="featured-content">
                    <div class="featured-meta">
                        <span class="featured-date">${escapeHtml(formatDate(post.date))}</span>
                        <span class="featured-reading-time">
                            üìñ ${post.readTime || '5 ph√∫t ƒë·ªçc'}
                        </span>
                    </div>
                    <h2 class="featured-title">
                        <a href="${escapeHtml(post.link)}">${post.title}</a>
                    </h2>
                    <p class="featured-excerpt">${post.excerpt}</p>
                    <div class="featured-tags">
                        ${Array.isArray(post.tags) ? post.tags.map(tag => 
                            `<span class="featured-tag" data-tag="${escapeHtml(tag)}">${escapeHtml(getDisplayName(tag))}</span>`
                        ).join('') : ''}
                    </div>
                </div>
            `;

            // Add click handlers for featured tags
            DOM.featuredPost.querySelectorAll('.featured-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tagValue = tag.dataset.tag;
                    if (tagValue) {
                        filterByTag(tagValue);
                    }
                });
            });
        }

        function renderPosts() {
            if (!DOM.postsGrid || !DOM.noResults || !DOM.pagination) return;
            
            const startIndex = currentFilter === 'all' && Array.isArray(filteredPosts) && filteredPosts.length > 0 ? 1 : 0;
            const postsToShow = Array.isArray(filteredPosts) ? filteredPosts.slice(startIndex) : [];
            
            // Calculate pagination
            totalPages = Math.ceil(postsToShow.length / POSTS_PER_PAGE);
            const startIdx = (currentPage - 1) * POSTS_PER_PAGE;
            const endIdx = startIdx + POSTS_PER_PAGE;
            const currentPosts = postsToShow.slice(startIdx, endIdx);

            if (currentPosts.length === 0 && startIndex === 0) {
                DOM.postsGrid.style.display = 'none';
                DOM.noResults.style.display = 'block';
                DOM.pagination.style.display = 'none';
                return;
            }

            DOM.postsGrid.style.display = 'grid';
            DOM.noResults.style.display = 'none';

            DOM.postsGrid.innerHTML = currentPosts.map(post => {
                if (!post) return '';
                
                const imageContent = post.imageType === 'image' && isValidImageUrl(post.image) ? 
                    `<img src="${escapeHtml(post.image)}" alt="${escapeHtml(post.title)}" onerror="this.parentElement.innerHTML='${getEmojiForTags(post.tags)}'; this.parentElement.classList.add('emoji');">` : 
                    escapeHtml(post.image || 'üìÑ');

                return `
                    <article class="post-card fade-in">
                        <div class="post-image ${post.imageType === 'emoji' ? 'emoji' : ''}">
                            ${imageContent}
                        </div>
                        <div class="post-content">
                            <div class="post-meta">
                                <span class="post-date">${escapeHtml(formatDate(post.date))}</span>
                                <span class="post-reading-time">
                                    üìñ ${post.readTime || '5 ph√∫t ƒë·ªçc'}
                                </span>
                            </div>
                            <h2 class="post-title">
                                <a href="${escapeHtml(post.link)}">${post.title}</a>
                            </h2>
                            <p class="post-excerpt">${post.excerpt}</p>
                            <div class="post-tags">
                                ${Array.isArray(post.tags) ? post.tags.map(tag => 
                                    `<span class="post-tag" data-tag="${escapeHtml(tag)}">${escapeHtml(getDisplayName(tag))}</span>`
                                ).join('') : ''}
                            </div>
                        </div>
                    </article>
                `;
            }).join('');

            // Add click handlers for post tags
            DOM.postsGrid.querySelectorAll('.post-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tagValue = tag.dataset.tag;
                    if (tagValue) {
                        filterByTag(tagValue);
                    }
                });
            });

            updatePagination();
        }

        // ====================================================================
        // üõçÔ∏è SHOPEE WIDGET FUNCTIONS (IMPROVED)
        // ====================================================================

        function checkIfMobile() {
            isMobile = window.innerWidth <= 768;
            return isMobile;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function processShopeeProducts(allPosts) {
            extractedShopeeProducts = [];
            
            if (!Array.isArray(allPosts)) return;
            
            allPosts.forEach(post => {
                if (post && Array.isArray(post.shopeeProducts)) {
                    extractedShopeeProducts.push(...post.shopeeProducts);
                }
            });
            
            console.log(`üõí Extracted ${extractedShopeeProducts.length} Shopee products from posts`);
        }

        function renderShopeeProducts(containerId = 'shopeeProducts', widgetId = 'shopeeWidget') {
            const shopeeWidget = document.getElementById(widgetId);
            const shopeeProducts = document.getElementById(containerId);
            
            if (!shopeeWidget || !shopeeProducts) return;
            
            checkIfMobile();
            
            // Use extracted products from posts if available, fallback to demo
            let productsToShow = extractedShopeeProducts.length > 0 ? 
                [...extractedShopeeProducts] : 
                getDemoShopeeProducts();
            
            if (productsToShow.length === 0) {
                shopeeWidget.style.display = 'none';
                return;
            }
            
            shopeeWidget.style.display = 'block';
            
            if (isMobile) {
                // Mobile: Carousel with single product
                shopeeProducts.className = 'shopee-products mobile-carousel';
                currentProductIndex = 0;
                
                shopeeProducts.innerHTML = `
                    <button class="shopee-refresh-btn" onclick="nextProduct()">üîÑ S·∫£n ph·∫©m kh√°c</button>
                    <div class="mobile-carousel-container" id="carouselContainer">
                        ${productsToShow.map((product, index) => renderSingleProduct(product, index)).join('')}
                    </div>
                    <div class="carousel-indicators" id="carouselIndicators">
                        ${productsToShow.map((_, index) => 
                            `<div class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="goToProduct(${index})"></div>`
                        ).join('')}
                    </div>
                    <div class="carousel-navigation">
                        <button class="carousel-nav-btn" onclick="prevProduct()">‚Äπ</button>
                        <button class="carousel-nav-btn" onclick="nextProduct()">‚Ä∫</button>
                    </div>
                `;
                
                updateCarouselPosition();
                addTouchSupport();
                
            } else {
                // Desktop: 3 random products
                shopeeProducts.className = 'shopee-products';
                const randomProducts = shuffleArray(productsToShow).slice(0, SHOPEE_CONFIG.desktopProductsCount);
                
                shopeeProducts.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; margin-bottom: 15px;">
                        <button class="shopee-refresh-btn" onclick="refreshDesktopProducts()">üîÑ S·∫£n ph·∫©m kh√°c</button>
                    </div>
                    ${randomProducts.map((product, index) => renderSingleProduct(product, index)).join('')}
                `;
            }
        }

        function renderSingleProduct(product, index) {
            if (!product || !product.url) return '';
            
            const imageContent = product.image && isValidImageUrl(product.image) ? 
                `<img src="${escapeHtml(product.image)}" alt="${escapeHtml(product.name || 'S·∫£n ph·∫©m')}" onerror="this.parentElement.innerHTML='‚òï';">` : 
                '‚òï';
            
            return `
                <div class="shopee-product" onclick="window.open('${escapeHtml(product.url)}', '_blank', 'noopener,noreferrer')">
                    ${product.discount ? `<div class="shopee-discount">${escapeHtml(product.discount)}</div>` : ''}
                    <div class="shopee-product-image">
                        ${imageContent}
                    </div>
                    <div class="shopee-product-info">
                        <div class="shopee-product-name">${escapeHtml(product.name || 'S·∫£n ph·∫©m')}</div>
                        <div class="shopee-product-price">
                            ${escapeHtml(product.price || 'Xem gi√°')}
                            ${product.oldPrice ? `<span class="shopee-product-old-price">${escapeHtml(product.oldPrice)}</span>` : ''}
                        </div>
                        <button class="shopee-cta-button" onclick="event.stopPropagation(); window.open('${escapeHtml(product.url)}', '_blank', 'noopener,noreferrer')">
                            üõí Mua ngay
                        </button>
                    </div>
                    <div class="shopee-badge">${escapeHtml(product.badge || 'S·∫£n ph·∫©m')}</div>
                </div>
            `;
        }

        function getDemoShopeeProducts() {
            return [
                {
                    name: "B·ªô T√°ch Cafe G·ªëm S·ª© Cao C·∫•p K√®m ƒêƒ©a",
                    price: "90.000ƒë",
                    image: "https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=300&h=200&fit=crop",
                    url: "https://s.shopee.vn/1LWRLK1RkU",
                    badge: "Cao c·∫•p"
                },
                {
                    name: "·∫§m R√≥t N∆∞·ªõc C·ªï Ng·ªóng Chuy√™n Nghi·ªáp",
                    price: "189.000ƒë",
                    image: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=300&h=200&fit=crop",
                    url: "https://s.shopee.vn/1VprXd0oPX",
                    badge: "Best seller"
                },
                {
                    name: "B√¨nh Pha C√† Ph√™ Nh·ªè Gi·ªçt Cold Brew",
                    price: "669.000ƒë",
                    image: "https://images.unsplash.com/photo-1611564635773-3217d88450ed?w=300&h=200&fit=crop",
                    url: "https://s.shopee.vn/10tawi2iQS",
                    badge: "Premium"
                }
            ];
        }

        // Carousel navigation functions
        function updateCarouselPosition() {
            const container = document.getElementById('carouselContainer');
            const indicators = document.querySelectorAll('.carousel-dot');
            
            if (container) {
                container.style.transform = `translateX(-${currentProductIndex * 100}%)`;
            }
            
            indicators.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentProductIndex);
            });
        }

        function nextProduct() {
            if (!isMobile) return;
            const totalProducts = extractedShopeeProducts.length > 0 ? extractedShopeeProducts.length : getDemoShopeeProducts().length;
            currentProductIndex = (currentProductIndex + 1) % totalProducts;
            updateCarouselPosition();
        }

        function prevProduct() {
            if (!isMobile) return;
            const totalProducts = extractedShopeeProducts.length > 0 ? extractedShopeeProducts.length : getDemoShopeeProducts().length;
            currentProductIndex = (currentProductIndex - 1 + totalProducts) % totalProducts;
            updateCarouselPosition();
        }

        function goToProduct(index) {
            if (!isMobile) return;
            currentProductIndex = index;
            updateCarouselPosition();
        }

        function refreshDesktopProducts() {
            if (isMobile) return;
            renderShopeeProducts();
        }

        function addTouchSupport() {
            const container = document.getElementById('carouselContainer');
            if (!container) return;
            
            let startX = 0;
            let isDragging = false;
            
            const handleStart = (e) => {
                isDragging = true;
                const touch = e.touches ? e.touches[0] : e;
                startX = touch.clientX;
            };
            
            const handleMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();
            };
            
            const handleEnd = (e) => {
                if (!isDragging) return;
                isDragging = false;
                
                const touch = e.changedTouches ? e.changedTouches[0] : e;
                const endX = touch.clientX;
                const deltaX = startX - endX;
                
                if (Math.abs(deltaX) > 50) {
                    if (deltaX > 0) {
                        nextProduct();
                    } else {
                        prevProduct();
                    }
                }
            };
            
            container.addEventListener('touchstart', handleStart, { passive: true });
            container.addEventListener('touchmove', handleMove, { passive: false });
            container.addEventListener('touchend', handleEnd, { passive: true });
        }

        // ====================================================================
        // üéØ FILTER & SEARCH FUNCTIONS (IMPROVED)
        // ====================================================================

        function generateFilterOptions() {
            if (!Array.isArray(allPosts) || !DOM.filterOptions) return;
            
            const allTags = [...new Set(allPosts.flatMap(post => 
                Array.isArray(post.tags) ? post.tags : []
            ))].filter(Boolean);
            
            DOM.filterOptions.innerHTML = '<div class="filter-option selected" data-tag="all">T·∫•t c·∫£</div>';
            
            allTags.sort().forEach(tag => {
                if (tag && typeof tag === 'string') {
                    const displayName = getDisplayName(tag);
                    const optionElement = document.createElement('div');
                    optionElement.className = 'filter-option';
                    optionElement.setAttribute('data-tag', escapeHtml(tag));
                    optionElement.textContent = displayName;
                    DOM.filterOptions.appendChild(optionElement);
                }
            });
            
            attachFilterOptionListeners();
        }

        function getDisplayName(tag) {
            if (!tag || typeof tag !== 'string') return 'Kh√¥ng r√µ';
            
            const displayNames = {
                'brewing': 'Pha ch·∫ø',
                'origin': 'Ngu·ªìn g·ªëc', 
                'review': 'ƒê√°nh gi√°',
                'tips': 'M·∫πo hay',
                'culture': 'VƒÉn h√≥a',
                'equipment': 'D·ª•ng c·ª•',
                'coffee': 'C√† ph√™',
                'vietnamese': 'Vi·ªát Nam',
                'arabica': 'Arabica',
                'robusta': 'Robusta',
                'specialty': 'ƒê·∫∑c bi·ªát',
                'health': 'S·ª©c kh·ªèe',
                'cold': 'L·∫°nh',
                'latte': 'Latte',
                'espresso': 'Espresso',
                'phin': 'Phin',
                'b·∫£o qu·∫£n c√† ph√™': 'B·∫£o qu·∫£n c√† ph√™',
                'rang c√† ph√™': 'Rang c√† ph√™',
                'light roast': 'Light roast',
                'medium roast': 'Medium roast', 
                'dark roast': 'Dark roast'
            };
            
            const lowerTag = tag.toLowerCase();
            return displayNames[lowerTag] || (tag.charAt(0).toUpperCase() + tag.slice(1));
        }

        function attachFilterOptionListeners() {
            if (!DOM.filterOptions) return;
            
            const filterOptionElements = DOM.filterOptions.querySelectorAll('.filter-option');
            filterOptionElements.forEach(option => {
                option.addEventListener('click', (e) => {
                    try {
                        e.preventDefault();
                        
                        filterOptionElements.forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                        
                        if (DOM.selectedFilter) {
                            DOM.selectedFilter.textContent = option.textContent || 'T·∫•t c·∫£';
                        }
                        
                        if (DOM.filterOptions && DOM.filterDropdown) {
                            DOM.filterOptions.classList.remove('show');
                            DOM.filterDropdown.classList.remove('active');
                        }
                        
                        const tagValue = option.dataset.tag;
                        if (tagValue) {
                            filterByTag(tagValue);
                        }
                    } catch (error) {
                        console.error('Error in filter option click:', error);
                    }
                });
            });
        }

        function filterByTag(tag) {
            if (!tag || typeof tag !== 'string') return;
            
            currentPage = 1;
            currentFilter = tag;
            
            const cacheKey = `${tag}_${DOM.searchInput?.value || ''}`;
            if (filterCache.has(cacheKey)) {
                filteredPosts = filterCache.get(cacheKey);
                renderFeaturedPost();
                renderPosts();
                updateStats();
            } else {
                filterPosts();
            }
        }

        function handleSearch(query = '') {
            if (typeof query !== 'string') query = '';
            
            const sanitizedQuery = query.toLowerCase().trim();
            
            if (DOM.searchInput && DOM.mobileSearchInput) {
                if (DOM.searchInput.value !== query) DOM.searchInput.value = query;
                if (DOM.mobileSearchInput.value !== query) DOM.mobileSearchInput.value = query;
            }
            
            filterPosts(sanitizedQuery);
        }

        function filterPosts(searchQuery = '') {
            if (!Array.isArray(allPosts)) {
                filteredPosts = [];
                hideLoading();
                renderFeaturedPost();
                renderPosts();
                updateStats();
                return;
            }
            
            showLoading();
            
            const cacheKey = `${currentFilter}_${searchQuery}`;
            if (filterCache.has(cacheKey)) {
                filteredPosts = filterCache.get(cacheKey);
                hideLoading();
                renderFeaturedPost();
                renderPosts();
                updateStats();
                return;
            }
            
            setTimeout(() => {
                try {
                    filteredPosts = allPosts.filter(post => {
                        if (!post) return false;
                        
                        const matchesTag = currentFilter === 'all' || 
                            (Array.isArray(post.tags) && post.tags.includes(currentFilter));
                        
                        const matchesSearch = searchQuery === '' || 
                            (post.title && post.title.toLowerCase().includes(searchQuery)) ||
                            (post.excerpt && post.excerpt.toLowerCase().includes(searchQuery)) ||
                            (Array.isArray(post.tags) && post.tags.some(tag => 
                                tag && tag.toLowerCase().includes(searchQuery)));
                        
                        return matchesTag && matchesSearch;
                    });

                    filterCache.set(cacheKey, [...filteredPosts]);
                    
                    if (filterCache.size > 50) {
                        const firstKey = filterCache.keys().next().value;
                        filterCache.delete(firstKey);
                    }

                    currentPage = 1;
                    
                } catch (error) {
                    console.error('Error in filterPosts:', error);
                    filteredPosts = [];
                } finally {
                    hideLoading();
                    renderFeaturedPost();
                    renderPosts();
                    updateStats();
                    renderShopeeProducts(); // Update Shopee products when filtering
                }
            }, 100);
        }

        // ====================================================================
        // üìÑ PAGINATION & UI UTILITIES
        // ====================================================================

        function updatePagination() {
            if (!DOM.pagination || !DOM.prevBtn || !DOM.nextBtn || !DOM.paginationInfo) return;
            
            try {
                if (totalPages <= 1) {
                    DOM.pagination.style.display = 'none';
                    return;
                }

                DOM.pagination.style.display = 'flex';
                DOM.prevBtn.disabled = currentPage === 1;
                DOM.nextBtn.disabled = currentPage === totalPages;
                
                DOM.paginationInfo.textContent = `Trang ${currentPage} / ${totalPages}`;
            } catch (error) {
                console.error('Error updating pagination:', error);
            }
        }

        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderPosts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                renderPosts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateStats() {
            try {
                if (DOM.totalPostsEl) {
                    DOM.totalPostsEl.textContent = Array.isArray(allPosts) ? allPosts.length : 0;
                }
                
                if (DOM.totalTagsEl) {
                    const uniqueTags = Array.isArray(allPosts) ? 
                        [...new Set(allPosts.flatMap(post => 
                            Array.isArray(post.tags) ? post.tags : []
                        ))].filter(Boolean) : [];
                    DOM.totalTagsEl.textContent = uniqueTags.length;
                }
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        function showLoading() {
            if (DOM.loading) DOM.loading.style.display = 'block';
            if (DOM.postsGrid) DOM.postsGrid.style.display = 'none';
            if (DOM.noResults) DOM.noResults.style.display = 'none';
            if (DOM.pagination) DOM.pagination.style.display = 'none';
        }

        function hideLoading() {
            if (DOM.loading) DOM.loading.style.display = 'none';
        }

        function formatDate(dateString) {
            try {
                if (!dateString) return 'Kh√¥ng r√µ';
                
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'Kh√¥ng r√µ';
                
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 1) return 'H√¥m qua';
                if (diffDays <= 7) return `${diffDays} ng√†y tr∆∞·ªõc`;
                if (diffDays <= 30) return `${Math.ceil(diffDays / 7)} tu·∫ßn tr∆∞·ªõc`;
                
                return date.toLocaleDateString('vi-VN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                console.error('Error formatting date:', error);
                return 'Kh√¥ng r√µ';
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ====================================================================
        // üöÄ INITIALIZATION & EVENT LISTENERS (IMPROVED)
        // ====================================================================

        async function initializePosts() {
            console.log('üöÄ Initializing Anaro Coffee Blog...');
            showLoading();
            
            try {
                // Clear previous data
                allPosts = [];
                filteredPosts = [];
                extractedShopeeProducts = [];
                filterCache.clear();
                
                console.log('üìã Loading manual posts list...');
                allPosts = await loadManualPosts();
                
                // Ensure allPosts is an array
                if (!Array.isArray(allPosts)) {
                    allPosts = [];
                }
                
                filteredPosts = [...allPosts];
                console.log(`‚úÖ Loaded ${allPosts.length} posts total`);
                
                // Process Shopee products from all posts
                processShopeeProducts(allPosts);
                
            } catch (error) {
                console.error('‚ùå Failed to initialize blog:', error);
                allPosts = [];
                filteredPosts = [];
                extractedShopeeProducts = [];
            } finally {
                hideLoading();
                generateFilterOptions();
                renderFeaturedPost();
                renderPosts();
                renderShopeeProducts();
                updateStats();
                
                console.log('üéâ Blog initialization completed!');
            }
        }

        function setupEventListeners() {
            try {
                // Search functionality with debouncing
                const debouncedSearch = debounce(() => {
                    try {
                        const query = DOM.searchInput?.value || '';
                        handleSearch(query);
                    } catch (error) {
                        console.error('Error in search handler:', error);
                    }
                }, 300);
                
                const debouncedMobileSearch = debounce(() => {
                    try {
                        const query = DOM.mobileSearchInput?.value || '';
                        handleSearch(query);
                    } catch (error) {
                        console.error('Error in mobile search handler:', error);
                    }
                }, 300);

                if (DOM.searchInput) {
                    DOM.searchInput.addEventListener('input', debouncedSearch);
                }
                
                if (DOM.mobileSearchInput) {
                    DOM.mobileSearchInput.addEventListener('input', debouncedMobileSearch);
                }

                // Filter dropdown functionality
                if (DOM.filterDropdown) {
                    DOM.filterDropdown.addEventListener('click', (e) => {
                        try {
                            e.preventDefault();
                            DOM.filterDropdown.classList.toggle('active');
                            if (DOM.filterOptions) {
                                DOM.filterOptions.classList.toggle('show');
                            }
                        } catch (error) {
                            console.error('Error in filter dropdown:', error);
                        }
                    });
                }

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    try {
                        if (!e.target.closest('.filter-container')) {
                            if (DOM.filterDropdown) DOM.filterDropdown.classList.remove('active');
                            if (DOM.filterOptions) DOM.filterOptions.classList.remove('show');
                        }
                    } catch (error) {
                        console.error('Error in outside click handler:', error);
                    }
                });

                // Refresh functionality
                if (DOM.refreshBtn) {
                    DOM.refreshBtn.addEventListener('click', () => {
                        try {
                            console.log('üîÑ Refreshing posts...');
                            initializePosts();
                        } catch (error) {
                            console.error('Error in refresh:', error);
                        }
                    });
                }
                
                if (DOM.mobileRefreshBtn) {
                    DOM.mobileRefreshBtn.addEventListener('click', () => {
                        try {
                            console.log('üîÑ Refreshing posts (mobile)...');
                            initializePosts();
                        } catch (error) {
                            console.error('Error in mobile refresh:', error);
                        }
                    });
                }

                // Pagination
                if (DOM.prevBtn) {
                    DOM.prevBtn.addEventListener('click', goToPrevPage);
                }
                if (DOM.nextBtn) {
                    DOM.nextBtn.addEventListener('click', goToNextPage);
                }

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    try {
                        if (e.ctrlKey || e.metaKey) {
                            if (e.key === 'k') {
                                e.preventDefault();
                                if (DOM.searchInput) DOM.searchInput.focus();
                            } else if (e.key === 'r') {
                                e.preventDefault();
                                initializePosts();
                            }
                        }
                    } catch (error) {
                        console.error('Error in keyboard shortcut:', error);
                    }
                });

                console.log('üì± Event listeners initialized');
                
            } catch (error) {
                console.error('‚ùå Error setting up event listeners:', error);
            }
        }

        function handleWindowResize() {
            const wasMobile = isMobile;
            checkIfMobile();
            
            if (wasMobile !== isMobile) {
                renderShopeeProducts();
            }
        }

        function initShopeeWidget() {
            // Expose functions to global scope
            window.nextProduct = nextProduct;
            window.prevProduct = prevProduct;
            window.goToProduct = goToProduct;
            window.refreshDesktopProducts = refreshDesktopProducts;
            
            // Add keyboard support
            document.addEventListener('keydown', (e) => {
                if (isMobile) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        prevProduct();
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        nextProduct();
                    }
                }
            });
            
            // Add resize listener
            const debouncedResize = debounce(handleWindowResize, 300);
            window.addEventListener('resize', debouncedResize);
            
            console.log('üõí Shopee Widget initialized');
        }

        // ====================================================================
        // üé¨ MAIN EXECUTION
        // ====================================================================

        // Initialize Shopee widget when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initShopeeWidget);
        } else {
            initShopeeWidget();
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded');
            try {
                setupEventListeners();
                initializePosts();
            } catch (error) {
                console.error('‚ùå Error in DOMContentLoaded:', error);
            }
        });

        // Handle errors globally
        window.addEventListener('error', (e) => {
            console.error('üí• Global error:', e.error);
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('üí• Unhandled promise rejection:', e.reason);
        });

        console.log('‚òï Anaro Coffee Blog with improved Shopee Widget loaded successfully!');
    </script>

s {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .shopee-product-image {
                height: 200px;
                font-size: 4em;
            }

            .shopee-widget {
                padding: 20px;
                margin-bottom: 30px;
            }

            .shopee-widget h3 {
                font-size: 1.2em;
                margin-bottom: 20px;
            }

            .shopee-product-info {
                padding: 15px;
            }

            .shopee-product</body></html>
